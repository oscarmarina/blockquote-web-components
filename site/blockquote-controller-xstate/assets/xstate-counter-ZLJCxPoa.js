var Bt=Object.defineProperty;var Lt=(e,t,n)=>t in e?Bt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var U=(e,t,n)=>(Lt(e,typeof t!="symbol"?t+"":t,n),n),Wt=(e,t,n)=>{if(!t.has(e))throw TypeError("Cannot "+n)};var M=(e,t,n)=>(Wt(e,t,"read from private field"),n?n.call(e):t.get(e)),at=(e,t,n)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,n)};import{i as qt,s as Ut,x as Kt}from"./lit-element-cJxZ_urQ.js";function Yt(){if(typeof globalThis<"u")return globalThis;if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global}function Xt(){const e=Yt();if(e.__xstate__)return e.__xstate__}const Pt=e=>{if(typeof window>"u")return;const t=Xt();t&&t.register(e)};class ut{constructor(t){this._process=t,this._active=!1,this._current=null,this._last=null}start(){this._active=!0,this.flush()}clear(){this._current&&(this._current.next=null,this._last=this._current)}enqueue(t){const n={value:t,next:null};if(this._current){this._last.next=n,this._last=n;return}this._current=n,this._last=n,this._active&&this.flush()}flush(){for(;this._current;){const t=this._current;this._process(t.value),this._current=t.next}this._last=null}}const W=".",Zt="",_t="",Ht="#",Ft="*",bt="xstate.init",X="xstate.stop";function Vt(e,t){const n=t?`#${t}`:"";return{type:`xstate.after(${e})${n}`}}function P(e,t){return{type:`xstate.done.state.${e}`,output:t}}function Qt(e,t){return{type:`xstate.done.actor.${e}`,output:t}}function D(e,t){return{type:`xstate.error.actor.${e}`,data:t}}function xt(e){return{type:bt,input:e}}function T(e){setTimeout(()=>{throw e})}const Nt=(()=>typeof Symbol=="function"&&Symbol.observable||"@@observable")();let te=0;function ee(e){const t=new Map,n=new Map,s=new WeakMap,i=new Set,r={_bookId:()=>`x:${te++}`,_register:(o,c)=>(t.set(o,c),o),_unregister:o=>{t.delete(o.sessionId);const c=s.get(o);c!==void 0&&(n.delete(c),s.delete(o))},get:o=>n.get(o),_set:(o,c)=>{const a=n.get(o);if(a&&a!==c)throw new Error(`Actor with system ID '${o}' already exists.`);n.set(o,c),s.set(c,o)},inspect:o=>{i.add(o)},_sendInspectionEvent:o=>{const c={...o,rootId:e.sessionId};i.forEach(a=>{var u;return(u=a.next)==null?void 0:u.call(a,c)})},_relay:(o,c,a)=>{r._sendInspectionEvent({type:"@xstate.event",sourceRef:o,actorRef:c,event:a}),c._send(a)}};return r}function wt(e,t){const n=ht(e),s=ht(t);return typeof s=="string"?typeof n=="string"?s===n:!1:typeof n=="string"?n in s:Object.keys(n).every(i=>i in s?wt(n[i],s[i]):!1)}function St(e){try{return Et(e)?e:e.split(W)}catch{throw new Error(`'${e}' is not a valid state path.`)}}function ht(e){if(je(e))return e.value;if(typeof e!="string")return e;const t=St(e);return ne(t)}function ne(e){if(e.length===1)return e[0];const t={};let n=t;for(let s=0;s<e.length-1;s++)if(s===e.length-2)n[e[s]]=e[s+1];else{const i=n;n={},i[e[s]]=n}return t}function ft(e,t){const n={},s=Object.keys(e);for(let i=0;i<s.length;i++){const r=s[i];n[r]=t(e[r],r,e,i)}return n}function Tt(e){return[].concat(...e)}function kt(e){return Et(e)?e:[e]}function v(e){return e===void 0?[]:kt(e)}function Z(e,t,n,s){return typeof e=="function"?e({context:t,event:n,self:s}):e}function Et(e){return Array.isArray(e)}function se(e){return e.type.startsWith("xstate.error.actor")}function E(e){return kt(e).map(t=>typeof t>"u"||typeof t=="string"?{target:t}:t)}function $t(e){if(!(e===void 0||e===Zt))return v(e)}function dt(e,t,n){var r,o,c;const s=typeof e=="object",i=s?e:void 0;return{next:(r=s?e.next:e)==null?void 0:r.bind(i),error:(o=s?e.error:t)==null?void 0:o.bind(i),complete:(c=s?e.complete:n)==null?void 0:c.bind(i)}}function lt(e,t){return`${e}[${t}]`}function N(e,t){if(t.startsWith("xstate#")){const[,n]=t.match(/\[(\d+)\]$/),i=e.getStateNodeById(t.slice(7,-(n.length+2))).config.invoke;return(Array.isArray(i)?i[n]:i).src}return e.implementations.actors[t]}function ie(e){return[...new Set(Tt([...e._nodes.map(t=>t.ownEvents)]))]}const tt=1;let g=function(e){return e[e.NotStarted=0]="NotStarted",e[e.Running=1]="Running",e[e.Stopped=2]="Stopped",e}({});const re={clock:{setTimeout:(e,t)=>setTimeout(e,t),clearTimeout:e=>clearTimeout(e)},logger:console.log.bind(console),devTools:!1};class oe{constructor(t,n){var f,d;this.logic=t,this._state=void 0,this.clock=void 0,this.options=void 0,this.id=void 0,this.mailbox=new ut(this._process.bind(this)),this.delayedEventsMap={},this.observers=new Set,this.logger=void 0,this._processingStatus=g.NotStarted,this._parent=void 0,this._syncSnapshot=void 0,this.ref=void 0,this._actorScope=void 0,this._systemId=void 0,this.sessionId=void 0,this.system=void 0,this._doneEvent=void 0,this.src=void 0,this._deferred=[];const s={...re,...n},{clock:i,logger:r,parent:o,syncSnapshot:c,id:a,systemId:u,inspect:h}=s;this.system=(f=o==null?void 0:o.system)!=null?f:ee(this),h&&!o&&this.system.inspect(dt(h)),this.sessionId=this.system._bookId(),this.id=a!=null?a:this.sessionId,this.logger=r,this.clock=i,this._parent=o,this._syncSnapshot=c,this.options=s,this.src=(d=s.src)!=null?d:t,this.ref=this,this._actorScope={self:this,id:this.id,sessionId:this.sessionId,logger:this.logger,defer:l=>{this._deferred.push(l)},system:this.system,stopChild:l=>{if(l._parent!==this)throw new Error(`Cannot stop child actor ${l.id} of ${this.id} because it is not a child`);l._stop()}},this.send=this.send.bind(this),this.system._sendInspectionEvent({type:"@xstate.actor",actorRef:this}),u&&(this._systemId=u,this.system._set(u,this)),this._initState(n==null?void 0:n.state),u&&this._state.status!=="active"&&this.system._unregister(this)}_initState(t){var n;this._state=t?this.logic.restoreState?this.logic.restoreState(t,this._actorScope):t:this.logic.getInitialState(this._actorScope,(n=this.options)==null?void 0:n.input)}update(t,n){var i;this._state=t;let s;for(;s=this._deferred.shift();)s();for(const r of this.observers)try{(i=r.next)==null||i.call(r,t)}catch(o){T(o)}switch(this._state.status){case"done":this._stopProcedure(),this._complete(),this._doneEvent=Qt(this.id,this._state.output),this._parent&&this.system._relay(this,this._parent,this._doneEvent);break;case"error":this._stopProcedure(),this._error(this._state.error),this._parent&&this.system._relay(this,this._parent,D(this.id,this._state.error));break}this.system._sendInspectionEvent({type:"@xstate.snapshot",actorRef:this,event:n,snapshot:t})}subscribe(t,n,s){var r;const i=dt(t,n,s);if(this._processingStatus!==g.Stopped)this.observers.add(i);else try{(r=i.complete)==null||r.call(i)}catch(o){T(o)}return{unsubscribe:()=>{this.observers.delete(i)}}}start(){var s;if(this._processingStatus===g.Running)return this;this._syncSnapshot&&this.subscribe({next:i=>{i.status==="active"&&this._parent.send({type:`xstate.snapshot.${this.id}`,snapshot:i})},error:()=>{}}),this.system._register(this.sessionId,this),this._systemId&&this.system._set(this._systemId,this),this._processingStatus=g.Running;const t=xt(this.options.input);switch(this.system._sendInspectionEvent({type:"@xstate.event",sourceRef:this._parent,actorRef:this,event:t}),this._state.status){case"done":this.update(this._state,t);case"error":return this}if(this.logic.start)try{this.logic.start(this._state,this._actorScope)}catch(i){return this._stopProcedure(),this._error(i),(s=this._parent)==null||s.send(D(this.id,i)),this}return this.update(this._state,t),this.options.devTools&&this.attachDevTools(),this.mailbox.start(),this}_process(t){var i;let n,s;try{n=this.logic.transition(this._state,t,this._actorScope)}catch(r){s={err:r}}if(s){const{err:r}=s;this._stopProcedure(),this._error(r),(i=this._parent)==null||i.send(D(this.id,r));return}this.update(n,t),t.type===X&&(this._stopProcedure(),this._complete())}_stop(){return this._processingStatus===g.Stopped?this:(this.mailbox.clear(),this._processingStatus===g.NotStarted?(this._processingStatus=g.Stopped,this):(this.mailbox.enqueue({type:X}),this))}stop(){if(this._parent)throw new Error("A non-root actor cannot be stopped directly.");return this._stop()}_complete(){var t;for(const n of this.observers)try{(t=n.complete)==null||t.call(n)}catch(s){T(s)}this.observers.clear()}_error(t){if(!this.observers.size){this._parent||T(t);return}let n=!1;for(const s of this.observers){const i=s.error;n||(n=!i);try{i==null||i(t)}catch(r){T(r)}}this.observers.clear(),n&&T(t)}_stopProcedure(){if(this._processingStatus!==g.Running)return this;for(const t of Object.keys(this.delayedEventsMap))this.clock.clearTimeout(this.delayedEventsMap[t]);return this.mailbox.clear(),this.mailbox=new ut(this._process.bind(this)),this._processingStatus=g.Stopped,this.system._unregister(this),this}_send(t){this._processingStatus!==g.Stopped&&this.mailbox.enqueue(t)}send(t){this.system._relay(void 0,this,t)}delaySend(t){const{event:n,id:s,delay:i}=t,r=this.clock.setTimeout(()=>{var o;this.system._relay(this,(o=t.to)!=null?o:this,n)},i);s&&(this.delayedEventsMap[s]=r)}cancel(t){this.clock.clearTimeout(this.delayedEventsMap[t]),delete this.delayedEventsMap[t]}attachDevTools(){const{devTools:t}=this.options;t&&(typeof t=="function"?t:Pt)(this)}toJSON(){return{xstate$$type:tt,id:this.id}}getPersistedState(t){return this.logic.getPersistedState(this._state,t)}[Nt](){return this}getSnapshot(){return this._state}}function R(e,t){return new oe(e,t)}function ce(e,t,n,s,{sendId:i}){const r=typeof i=="function"?i(n,s):i;return[t,r]}function ae(e,t){e.self.cancel(t)}function ue(e){function t(n,s){}return t.type="xstate.cancel",t.sendId=e,t.resolve=ce,t.execute=ae,t}function he(e,t,n,s,{id:i,systemId:r,src:o,input:c,syncSnapshot:a}){const u=typeof o=="string"?N(t.machine,o):o,h=typeof i=="function"?i(n):i;let f;return u&&(f=R(u,{id:h,src:o,parent:e==null?void 0:e.self,syncSnapshot:a,systemId:r,input:typeof c=="function"?c({context:t.context,event:n.event,self:e==null?void 0:e.self}):c})),[S(t,{children:{...t.children,[h]:f}}),{id:i,actorRef:f}]}function fe(e,{id:t,actorRef:n}){n&&e.defer(()=>{var s;if(n._processingStatus!==g.Stopped)try{(s=n.start)==null||s.call(n)}catch(i){e.self.send(D(t,i));return}})}function de(...[e,{id:t,systemId:n,input:s,syncSnapshot:i=!1}={}]){function r(o,c){}return r.type="xstate.spawnChild",r.id=t,r.systemId=n,r.src=e,r.input=s,r.syncSnapshot=i,r.resolve=he,r.execute=fe,r}function le(e,t,n,s,{actorRef:i}){const r=typeof i=="function"?i(n,s):i,o=typeof r=="string"?t.children[r]:r;let c=t.children;return o&&(c={...c},delete c[o.id]),[S(t,{children:c}),o]}function pe(e,t){if(t){if(e.system._unregister(t),t._processingStatus!==g.Running){e.stopChild(t);return}e.defer(()=>{e.stopChild(t)})}}function It(e){function t(n,s){}return t.type="xstate.stopChild",t.actorRef=e,t.resolve=le,t.execute=pe,t}function et(e,t,n,s){const{machine:i}=s,r=typeof e=="function",o=r?e:i.implementations.guards[typeof e=="string"?e:e.type];if(!r&&!o)throw new Error(`Guard '${typeof e=="string"?e:e.type}' is not implemented.'.`);if(typeof o!="function")return et(o,t,n,s);const c={context:t,event:n},a=r||typeof e=="string"?void 0:"params"in e?typeof e.params=="function"?e.params({context:t,event:n}):e.params:void 0;return"check"in o?o.check(s,c,o):o(c,a)}const nt=e=>e.type==="atomic"||e.type==="final";function I(e){return Object.values(e.states).filter(t=>t.type!=="history")}function z(e,t){const n=[];if(t===e)return n;let s=e.parent;for(;s&&s!==t;)n.push(s),s=s.parent;return n}function G(e){const t=new Set(e),n=Ot(t);for(const s of t)if(s.type==="compound"&&(!n.get(s)||!n.get(s).length))pt(s).forEach(i=>t.add(i));else if(s.type==="parallel"){for(const i of I(s))if(i.type!=="history"&&!t.has(i)){const r=pt(i);for(const o of r)t.add(o)}}for(const s of t){let i=s.parent;for(;i;)t.add(i),i=i.parent}return t}function At(e,t){const n=t.get(e);if(!n)return{};if(e.type==="compound"){const i=n[0];if(i){if(nt(i))return i.key}else return{}}const s={};for(const i of n)s[i.key]=At(i,t);return s}function Ot(e){const t=new Map;for(const n of e)t.has(n)||t.set(n,[]),n.parent&&(t.has(n.parent)||t.set(n.parent,[]),t.get(n.parent).push(n));return t}function Mt(e,t){const n=G(t);return At(e,Ot(n))}function st(e,t){return t.type==="compound"?I(t).some(n=>n.type==="final"&&e.has(n)):t.type==="parallel"?I(t).every(n=>st(e,n)):t.type==="final"}const q=e=>e[0]===Ht;function ye(e,t){return e.transitions.get(t)||[...e.transitions.keys()].filter(s=>{if(s===Ft)return!0;if(!s.endsWith(".*"))return!1;const i=s.split("."),r=t.split(".");for(let o=0;o<i.length;o++){const c=i[o],a=r[o];if(c==="*")return o===i.length-1;if(c!==a)return!1}return!0}).sort((s,i)=>i.length-s.length).flatMap(s=>e.transitions.get(s))}function ge(e){const t=e.config.after;if(!t)return[];const n=(i,r)=>{const o=typeof i=="function"?`${e.id}:delay[${r}]`:i,c=Vt(o,e.id),a=c.type;return e.entry.push(qe(c,{id:a,delay:i})),e.exit.push(ue(a)),a};return Object.keys(t).flatMap((i,r)=>{const o=t[i],c=typeof o=="string"?{target:o}:o,a=isNaN(+i)?i:+i,u=n(a,r);return v(c).map(h=>({...h,event:u,delay:a}))}).map(i=>{const{delay:r}=i;return{...b(e,i.event,i),delay:r}})}function b(e,t,n){var c;const s=$t(n.target),i=(c=n.reenter)!=null?c:!1,r=_e(e,s),o={...n,actions:v(n.actions),guard:n.guard,target:r,source:e,reenter:i,eventType:t,toJSON:()=>({...o,source:`#${e.id}`,target:r?r.map(a=>`#${a.id}`):void 0})};return o}function me(e){const t=new Map;if(e.config.on)for(const n of Object.keys(e.config.on)){if(n===_t)throw new Error('Null events ("") cannot be specified as a transition key. Use `always: { ... }` instead.');const s=e.config.on[n];t.set(n,E(s).map(i=>b(e,n,i)))}if(e.config.onDone){const n=`xstate.done.state.${e.id}`;t.set(n,E(e.config.onDone).map(s=>b(e,n,s)))}for(const n of e.invoke){if(n.onDone){const s=`xstate.done.actor.${n.id}`;t.set(s,E(n.onDone).map(i=>b(e,s,i)))}if(n.onError){const s=`xstate.error.actor.${n.id}`;t.set(s,E(n.onError).map(i=>b(e,s,i)))}if(n.onSnapshot){const s=`xstate.snapshot.${n.id}`;t.set(s,E(n.onSnapshot).map(i=>b(e,s,i)))}}for(const n of e.after){let s=t.get(n.eventType);s||(s=[],t.set(n.eventType,s)),s.push(n)}return t}function ve(e,t){const n=typeof t=="string"?e.states[t]:t?e.states[t.target]:void 0;if(!n&&t)throw new Error(`Initial state node "${t}" not found on parent state node #${e.id}`);const s={source:e,actions:!t||typeof t=="string"?[]:v(t.actions),eventType:null,reenter:!1,target:n?[n]:[],toJSON:()=>({...s,source:`#${e.id}`,target:n?[`#${n.id}`]:[]})};return s}function _e(e,t){if(t!==void 0)return t.map(n=>{if(typeof n!="string")return n;if(q(n))return e.machine.getStateNodeById(n);const s=n[0]===W;if(s&&!e.parent)return B(e,n.slice(1));const i=s?e.key+n:n;if(e.parent)try{return B(e.parent,i)}catch(r){throw new Error(`Invalid transition definition for state node '${e.id}':
${r.message}`)}else throw new Error(`Invalid target: "${n}" is not a valid target from the root node. Did you mean ".${n}"?`)})}function Ct(e){const t=$t(e.config.target);return t?{target:t.map(n=>typeof n=="string"?B(e.parent,n):n)}:e.parent.initial}function x(e){return e.type==="history"}function pt(e){const t=jt(e);for(const n of t)for(const s of z(n,e))t.add(s);return t}function jt(e){const t=new Set;function n(s){if(!t.has(s)){if(t.add(s),s.type==="compound")n(s.initial.target[0]);else if(s.type==="parallel")for(const i of I(s))n(i)}}return n(e),t}function A(e,t){if(q(t))return e.machine.getStateNodeById(t);if(!e.states)throw new Error(`Unable to retrieve child state '${t}' from '${e.id}'; no child states exist.`);const n=e.states[t];if(!n)throw new Error(`Child state '${t}' does not exist on '${e.id}'`);return n}function B(e,t){if(typeof t=="string"&&q(t))try{return e.machine.getStateNodeById(t)}catch{}const n=St(t).slice();let s=e;for(;n.length;){const i=n.shift();if(!i.length)break;s=A(s,i)}return s}function L(e,t){if(typeof t=="string")return[e,e.states[t]];const n=Object.keys(t),s=n.map(i=>A(e,i)).filter(Boolean);return[e.machine.root,e].concat(s,n.reduce((i,r)=>{const o=A(e,r);if(!o)return i;const c=L(o,t[r]);return i.concat(c)},[]))}function be(e,t,n,s){const r=A(e,t).next(n,s);return!r||!r.length?e.next(n,s):r}function xe(e,t,n,s){const i=Object.keys(t),r=A(e,i[0]),o=it(r,t[i[0]],n,s);return!o||!o.length?e.next(n,s):o}function we(e,t,n,s){const i=[];for(const r of Object.keys(t)){const o=t[r];if(!o)continue;const c=A(e,r),a=it(c,o,n,s);a&&i.push(...a)}return i.length?i:e.next(n,s)}function it(e,t,n,s){return typeof t=="string"?be(e,t,n,s):Object.keys(t).length===1?xe(e,t,n,s):we(e,t,n,s)}function Se(e){return Object.keys(e.states).map(t=>e.states[t]).filter(t=>t.type==="history")}function _(e,t){let n=e;for(;n.parent&&n.parent!==t;)n=n.parent;return n.parent===t}function Te(e,t){const n=new Set(e),s=new Set(t);for(const i of n)if(s.has(i))return!0;for(const i of s)if(n.has(i))return!0;return!1}function Dt(e,t,n){const s=new Set;for(const i of e){let r=!1;const o=new Set;for(const c of s)if(Te(H([i],t,n),H([c],t,n)))if(_(i.source,c.source))o.add(c);else{r=!0;break}if(!r){for(const c of o)s.delete(c);s.add(i)}}return Array.from(s)}function ke(e){const[t,...n]=e;for(const s of z(t,void 0))if(n.every(i=>_(i,s)))return s}function rt(e,t){if(!e.target)return[];const n=new Set;for(const s of e.target)if(x(s))if(t[s.id])for(const i of t[s.id])n.add(i);else for(const i of rt(Ct(s),t))n.add(i);else n.add(s);return[...n]}function Rt(e,t){const n=rt(e,t);if(!n)return;if(!e.reenter&&n.every(i=>i===e.source||_(i,e.source)))return e.source;const s=ke(n.concat(e.source));if(s)return s;if(!e.reenter)return e.source.machine.root}function H(e,t,n){var i;const s=new Set;for(const r of e)if((i=r.target)!=null&&i.length){const o=Rt(r,n);r.reenter&&r.source===o&&s.add(o);for(const c of t)_(c,o)&&s.add(c)}return[...s]}function Ee(e,t){if(e.length!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;return!0}function F(e,t,n,s,i,r){if(!e.length)return t;const o=new Set(t._nodes);let c=t.historyValue;const a=Dt(e,o,c);let u=t;i||([u,c]=Oe(u,s,n,a,o,c,r)),u=O(u,s,n,a.flatMap(f=>f.actions),r),u=Ie(u,s,n,a,o,r,c,i);const h=[...o];u.status==="done"&&(u=O(u,s,n,h.sort((f,d)=>d.order-f.order).flatMap(f=>f.exit),r));try{return c===t.historyValue&&Ee(t._nodes,o)?u:S(u,{_nodes:h,historyValue:c})}catch(f){throw f}}function $e(e,t,n,s,i){if(!s.output)return;const r=P(i.id,i.output&&i.parent?Z(i.output,e.context,t,n.self):void 0);return Z(s.output,e.context,r,n.self)}function Ie(e,t,n,s,i,r,o,c){let a=e;const u=new Set,h=new Set;Ae(s,o,h,u),c&&h.add(e.machine.root);const f=new Set;for(const d of[...u].sort((l,p)=>l.order-p.order)){i.add(d);const l=[];l.push(...d.entry);for(const p of d.invoke)l.push(de(p.src,{...p,syncSnapshot:!!p.onSnapshot}));if(h.has(d)){const p=d.initial.actions;l.push(...p)}if(a=O(a,t,n,l,r,d.invoke.map(p=>p.id)),d.type==="final"){const p=d.parent;let y=(p==null?void 0:p.type)==="parallel"?p:p==null?void 0:p.parent,m=y||d;for((p==null?void 0:p.type)==="compound"&&r.push(P(p.id,d.output?Z(d.output,a.context,t,n.self):void 0));(y==null?void 0:y.type)==="parallel"&&!f.has(y)&&st(i,y);)f.add(y),r.push(P(y.id)),m=y,y=y.parent;if(y)continue;a=S(a,{status:"done",output:$e(a,t,n,a.machine.root,m)})}}return a}function Ae(e,t,n,s){for(const i of e){const r=Rt(i,t);for(const c of i.target||[])!x(c)&&(i.source!==c||i.source!==r||i.reenter)&&(s.add(c),n.add(c)),$(c,t,n,s);const o=rt(i,t);for(const c of o){const a=z(c,r);(r==null?void 0:r.type)==="parallel"&&a.push(r),zt(s,t,n,a,!i.source.parent&&i.reenter?void 0:r)}}}function $(e,t,n,s){var i;if(x(e))if(t[e.id]){const r=t[e.id];for(const o of r)s.add(o),$(o,t,n,s);for(const o of r)K(o,e.parent,s,t,n)}else{const r=Ct(e);for(const o of r.target)s.add(o),r===((i=e.parent)==null?void 0:i.initial)&&n.add(e.parent),$(o,t,n,s);for(const o of r.target)K(o,e,s,t,n)}else if(e.type==="compound"){const[r]=e.initial.target;x(r)||(s.add(r),n.add(r)),$(r,t,n,s),K(r,e,s,t,n)}else if(e.type==="parallel")for(const r of I(e).filter(o=>!x(o)))[...s].some(o=>_(o,r))||(x(r)||(s.add(r),n.add(r)),$(r,t,n,s))}function zt(e,t,n,s,i){for(const r of s)if((!i||_(r,i))&&e.add(r),r.type==="parallel")for(const o of I(r).filter(c=>!x(c)))[...e].some(c=>_(c,o))||(e.add(o),$(o,t,n,e))}function K(e,t,n,s,i){zt(n,s,i,z(e,t))}function Oe(e,t,n,s,i,r,o){let c=e;const a=H(s,i,r);a.sort((h,f)=>f.order-h.order);let u;for(const h of a)for(const f of Se(h)){let d;f.history==="deep"?d=l=>nt(l)&&_(l,h):d=l=>l.parent===h,u!=null||(u={...r}),u[f.id]=Array.from(i).filter(d)}for(const h of a)c=O(c,t,n,[...h.exit,...h.invoke.map(f=>It(f.id))],o),i.delete(h);return[c,u||r]}function Jt(e,t,n,s,i,r){const{machine:o}=e;let c=e;for(const a of s){const u=typeof a=="function",h=u?a:o.implementations.actions[typeof a=="string"?a:a.type];if(!h)continue;const f={context:c.context,event:t,self:n==null?void 0:n.self,system:n==null?void 0:n.system},d=u||typeof a=="string"?void 0:"params"in a?typeof a.params=="function"?a.params({context:c.context,event:t}):a.params:void 0;if(!("resolve"in h)){(n==null?void 0:n.self._processingStatus)===g.Running?h(f,d):n==null||n.defer(()=>{h(f,d)});continue}const l=h,[p,y,m]=l.resolve(n,c,f,d,h,i);c=p,"retryResolve"in l&&(r==null||r.push([l,y])),"execute"in l&&((n==null?void 0:n.self._processingStatus)===g.Running?l.execute(n,y):n==null||n.defer(l.execute.bind(null,n,y))),m&&(c=Jt(c,t,n,m,i,r))}return c}function O(e,t,n,s,i,r){const o=r?[]:void 0,c=Jt(e,t,n,s,{internalQueue:i,deferredActorIds:r},o);return o==null||o.forEach(([a,u])=>{a.retryResolve(n,c,u)}),c}function Y(e,t,n,s=[]){let i=e;const r=[];if(t.type===X)return i=S(yt(i,t,n),{status:"stopped"}),r.push(i),{state:i,microstates:r};let o=t;if(o.type!==bt){const a=gt(o,i);i=F(a,e,n,o,!1,s),r.push(i)}let c=!0;for(;i.status==="active";){let a=c?Me(i,o):[];const u=a.length?i:void 0;if(!a.length){if(!s.length)break;o=s.shift(),a=gt(o,i)}i=F(a,i,n,o,!1,s),c=i!==u,r.push(i)}return i.status!=="active"&&yt(i,o,n),{state:i,microstates:r}}function yt(e,t,n){return O(e,t,n,Object.values(e.children).map(s=>It(s)),[])}function gt(e,t){return t.machine.getTransitionData(t,e)}function Me(e,t){const n=new Set,s=e._nodes.filter(nt);for(const i of s)t:for(const r of[i].concat(z(i,void 0)))if(r.always){for(const o of r.always)if(o.guard===void 0||et(o.guard,e.context,t,e)){n.add(o);break t}}return Dt(Array.from(n),new Set(e._nodes),e.historyValue)}function Ce(e,t){const n=G(L(e,t));return Mt(e,[...n])}function je(e){return!!e&&typeof e=="object"&&"machine"in e&&"value"in e}const De=function(t){return wt(t,this.value)},Re=function(t){return this.tags.has(t)},ze=function(t){const n=this.machine.getTransitionData(this,t);return!!(n!=null&&n.length)&&n.some(s=>s.target!==void 0||s.actions.length)},Je=function(){const{_nodes:t,tags:n,machine:s,getMeta:i,toJSON:r,can:o,hasTag:c,matches:a,...u}=this;return{...u,tags:Array.from(n)}},Ge=function(){return this._nodes.reduce((t,n)=>(n.meta!==void 0&&(t[n.id]=n.meta),t),{})};function J(e,t){return{status:e.status,output:e.output,error:e.error,machine:t,context:e.context,_nodes:e._nodes,value:Mt(t.root,e._nodes),tags:new Set(Tt(e._nodes.map(n=>n.tags))),children:e.children,historyValue:e.historyValue||{},matches:De,hasTag:Re,can:ze,getMeta:Ge,toJSON:Je}}function S(e,t={}){return J({...e,...t},e.machine)}function Be(e,t){const{_nodes:n,tags:s,machine:i,children:r,context:o,can:c,hasTag:a,matches:u,getMeta:h,toJSON:f,...d}=e,l={};for(const y in r){const m=r[y];l[y]={state:m.getPersistedState(t),src:m.src,systemId:m._systemId,syncSnapshot:m._syncSnapshot}}return{...d,context:Gt(o),children:l}}function Gt(e){let t;for(const n in e){const s=e[n];if(s&&typeof s=="object")if("sessionId"in s&&"send"in s&&"ref"in s)t!=null||(t=Array.isArray(e)?e.slice():{...e}),t[n]={xstate$$type:tt,id:s.id};else{const i=Gt(s);i!==s&&(t!=null||(t=Array.isArray(e)?e.slice():{...e}),t[n]=i)}}return t!=null?t:e}function Le(e,t,n,s,{event:i,id:r,delay:o},{internalQueue:c}){const a=t.machine.implementations.delays;if(typeof i=="string")throw new Error(`Only event objects may be used with raise; use raise({ type: "${i}" }) instead`);const u=typeof i=="function"?i(n,s):i;let h;if(typeof o=="string"){const f=a&&a[o];h=typeof f=="function"?f(n,s):f}else h=typeof o=="function"?o(n,s):o;return typeof h!="number"&&c.push(u),[t,{event:u,id:r,delay:h}]}function We(e,t){if(typeof t.delay=="number"){e.self.delaySend(t);return}}function qe(e,t){function n(s,i){}return n.type="xstate.raise",n.event=e,n.id=t==null?void 0:t.id,n.delay=t==null?void 0:t.delay,n.resolve=Le,n.execute=We,n}function Ue(e,{machine:t,context:n},s,i){const r=(o,c={})=>{const{systemId:a,input:u}=c;if(typeof o=="string"){const h=N(t,o);if(!h)throw new Error(`Actor logic '${o}' not implemented in machine '${t.id}'`);const f=R(h,{id:c.id,parent:e.self,syncSnapshot:c.syncSnapshot,input:typeof u=="function"?u({context:n,event:s,self:e.self}):u,src:o,systemId:a});return i[f.id]=f,f}else return R(o,{id:c.id,parent:e.self,syncSnapshot:c.syncSnapshot,input:c.input,src:o,systemId:a})};return(o,c)=>{const a=r(o,c);return i[a.id]=a,e.defer(()=>{var u;if(a._processingStatus!==g.Stopped)try{(u=a.start)==null||u.call(a)}catch(h){e.self.send(D(a.id,h));return}}),a}}function Ke(e,t,n,s,{assignment:i}){if(!t.context)throw new Error("Cannot assign to undefined `context`. Ensure that `context` is defined in the machine config.");const r={},o={context:t.context,event:n.event,spawn:Ue(e,t,n.event,r),self:e==null?void 0:e.self,system:e==null?void 0:e.system};let c={};if(typeof i=="function")c=i(o,s);else for(const u of Object.keys(i)){const h=i[u];c[u]=typeof h=="function"?h(o,s):h}const a=Object.assign({},t.context,c);return[S(t,{context:a,children:Object.keys(r).length?{...t.children,...r}:t.children})]}function V(e){function t(n,s){}return t.type="xstate.assign",t.assignment=e,t.resolve=Ke,t}const mt=new WeakMap;function k(e,t,n){let s=mt.get(e);return s?t in s||(s[t]=n()):(s={[t]:n()},mt.set(e,s)),s[t]}const Ye={},C=e=>typeof e=="string"?{type:e}:typeof e=="function"?"resolve"in e?{type:e.type}:{type:e.name}:e;class ot{constructor(t,n){if(this.config=t,this.key=void 0,this.id=void 0,this.type=void 0,this.path=void 0,this.states=void 0,this.history=void 0,this.entry=void 0,this.exit=void 0,this.parent=void 0,this.machine=void 0,this.meta=void 0,this.output=void 0,this.order=-1,this.description=void 0,this.tags=[],this.transitions=void 0,this.always=void 0,this.parent=n._parent,this.key=n._key,this.machine=n._machine,this.path=this.parent?this.parent.path.concat(this.key):[],this.id=this.config.id||[this.machine.id,...this.path].join(W),this.type=this.config.type||(this.config.states&&Object.keys(this.config.states).length?"compound":this.config.history?"history":"atomic"),this.description=this.config.description,this.order=this.machine.idMap.size,this.machine.idMap.set(this.id,this),this.states=this.config.states?ft(this.config.states,(s,i)=>new ot(s,{_parent:this,_key:i,_machine:this.machine})):Ye,this.type==="compound"&&!this.config.initial)throw new Error(`No initial state specified for compound state node "#${this.id}". Try adding { initial: "${Object.keys(this.states)[0]}" } to the state config.`);this.history=this.config.history===!0?"shallow":this.config.history||!1,this.entry=v(this.config.entry).slice(),this.exit=v(this.config.exit).slice(),this.meta=this.config.meta,this.output=this.type==="final"||!this.parent?this.config.output:void 0,this.tags=v(t.tags).slice()}_initialize(){this.transitions=me(this),this.config.always&&(this.always=E(this.config.always).map(t=>b(this,_t,t))),Object.keys(this.states).forEach(t=>{this.states[t]._initialize()})}get definition(){return{id:this.id,key:this.key,version:this.machine.version,type:this.type,initial:this.initial?{target:this.initial.target,source:this,actions:this.initial.actions.map(C),eventType:null,reenter:!1,toJSON:()=>({target:this.initial.target.map(t=>`#${t.id}`),source:`#${this.id}`,actions:this.initial.actions.map(C),eventType:null})}:void 0,history:this.history,states:ft(this.states,t=>t.definition),on:this.on,transitions:[...this.transitions.values()].flat().map(t=>({...t,actions:t.actions.map(C)})),entry:this.entry.map(C),exit:this.exit.map(C),meta:this.meta,order:this.order||-1,output:this.output,invoke:this.invoke,description:this.description,tags:this.tags}}toJSON(){return this.definition}get invoke(){return k(this,"invoke",()=>v(this.config.invoke).map((t,n)=>{const{src:s,systemId:i}=t,r=t.id||lt(this.id,n),o=typeof s=="string"?s:`xstate#${lt(this.id,n)}`;return{...t,src:o,id:r,systemId:i,toJSON(){const{onDone:c,onError:a,...u}=t;return{...u,type:"xstate.invoke",src:o,id:r}}}}))}get on(){return k(this,"on",()=>[...this.transitions].flatMap(([n,s])=>s.map(i=>[n,i])).reduce((n,[s,i])=>(n[s]=n[s]||[],n[s].push(i),n),{}))}get after(){return k(this,"delayedTransitions",()=>ge(this))}get initial(){return k(this,"initial",()=>ve(this,this.config.initial))}next(t,n){const s=n.type,i=[];let r;const o=k(this,`candidates-${s}`,()=>ye(this,s));for(const c of o){const{guard:a}=c,u=t.context;let h=!1;try{h=!a||et(a,u,n,t)}catch(f){const d=typeof a=="string"?a:typeof a=="object"?a.type:void 0;throw new Error(`Unable to evaluate guard ${d?`'${d}' `:""}in transition for event '${s}' in state node '${this.id}':
${f.message}`)}if(h){i.push(...c.actions),r=c;break}}return r?[r]:void 0}get events(){return k(this,"events",()=>{const{states:t}=this,n=new Set(this.ownEvents);if(t)for(const s of Object.keys(t)){const i=t[s];if(i.states)for(const r of i.events)n.add(`${r}`)}return Array.from(n)})}get ownEvents(){const t=new Set([...this.transitions.keys()].filter(n=>this.transitions.get(n).some(s=>!(!s.target&&!s.actions.length&&!s.reenter))));return Array.from(t)}}const Xe="#";class ct{constructor(t,n){var s,i,r,o,c;this.config=t,this.version=void 0,this.implementations=void 0,this.types=void 0,this.__xstatenode=!0,this.idMap=new Map,this.root=void 0,this.id=void 0,this.states=void 0,this.events=void 0,this.__TResolvedTypesMeta=void 0,this.id=t.id||"(machine)",this.implementations={actors:(s=n==null?void 0:n.actors)!=null?s:{},actions:(i=n==null?void 0:n.actions)!=null?i:{},delays:(r=n==null?void 0:n.delays)!=null?r:{},guards:(o=n==null?void 0:n.guards)!=null?o:{}},this.version=this.config.version,this.types=(c=this.config.types)!=null?c:{},this.transition=this.transition.bind(this),this.getInitialState=this.getInitialState.bind(this),this.restoreState=this.restoreState.bind(this),this.start=this.start.bind(this),this.root=new ot(t,{_key:this.id,_machine:this}),this.root._initialize(),this.states=this.root.states,this.events=this.root.events}provide(t){const{actions:n,guards:s,actors:i,delays:r}=this.implementations;return new ct(this.config,{actions:{...n,...t.actions},guards:{...s,...t.guards},actors:{...i,...t.actors},delays:{...r,...t.delays}})}resolveState(t){const n=Ce(this.root,t.value),s=G(L(this.root,n));return J({_nodes:[...s],context:t.context||{},children:{},status:st(s,this.root)?"done":t.status||"active",output:t.output,error:t.error,historyValue:t.historyValue},this)}transition(t,n,s){if(se(n)&&!ie(t).some(r=>r===n.type))return S(t,{status:"error",error:n.data});const{state:i}=Y(t,n,s);return i}microstep(t,n,s){return Y(t,n,s).microstates}getTransitionData(t,n){return it(this.root,t.value,t,n)||[]}getPreInitialState(t,n,s){const{context:i}=this.config,r=J({context:typeof i!="function"&&i?i:{},_nodes:[this.root],children:{},status:"active"},this);return typeof i=="function"?O(r,n,t,[V(({spawn:c,event:a})=>i({spawn:c,input:a.input}))],s):r}getInitialState(t,n){const s=xt(n),i=[],r=this.getPreInitialState(t,s,i),o=F([{target:[...jt(this.root)],source:this.root,reenter:!0,actions:[],eventType:null,toJSON:null}],r,t,s,!0,i),{state:c}=Y(o,s,t,i);return c}start(t){Object.values(t.children).forEach(n=>{n.getSnapshot().status==="active"&&n.start()})}getStateNodeById(t){const n=t.split(W),s=n.slice(1),i=q(n[0])?n[0].slice(Xe.length):n[0],r=this.idMap.get(i);if(!r)throw new Error(`Child state node '#${i}' does not exist on machine '${this.id}'`);return B(r,s)}get definition(){return this.root.definition}toJSON(){return this.definition}getPersistedState(t,n){return Be(t,n)}restoreState(t,n){const s={},i=t.children;Object.keys(i).forEach(a=>{const u=i[a],h=u.state,f=u.src,d=typeof f=="string"?N(this,f):f;if(!d)return;const l=R(d,{id:a,parent:n==null?void 0:n.self,syncSnapshot:u.syncSnapshot,state:h,src:f,systemId:u.systemId});s[a]=l});const r=J({...t,children:s,_nodes:Array.from(G(L(this.root,t.value)))},this);let o=new Set;function c(a,u){if(!o.has(a)){o.add(a);for(let h in a){const f=a[h];if(f&&typeof f=="object"){if("xstate$$type"in f&&f.xstate$$type===tt){a[h]=u[f.id];continue}c(f,u)}}}}return c(r.context,s),r}}function Pe(e,t){return new ct(e,t)}class Ze{constructor(t,n,s){(this.host=t).addController(this),this.service=R(n).start(),this.propKey=s}get state(){return this.service.getSnapshot()}send(t){this.service.send(t)}hostConnected(){this.service.subscribe(t=>{this.propKey in this.host&&(this.host[this.propKey]=t)})}hostDisconnected(){this.service.stop()}}const vt={enabled:"enabled",disabled:"disabled"},He={counter:({context:e})=>e.counter+1,event:({event:e})=>e},Fe={counter:({context:e})=>e.counter-1,event:({event:e})=>e},Ve=({context:e})=>e.counter<10,Qe=({context:e})=>e.counter>0,Ne=Pe({id:"counter",context:{counter:0,event:void 0},initial:"enabled",states:{enabled:{on:{INC:{actions:{type:"increment"},guard:{type:"isNotMax"}},DEC:{actions:{type:"decrement"},guard:{type:"isNotMin"}},TOGGLE:{target:vt.disabled}}},disabled:{on:{TOGGLE:{target:vt.enabled}}}}},{actions:{increment:V(He),decrement:V(Fe)},guards:{isNotMax:Ve,isNotMin:Qe}}),tn=qt`:host {
  --_mark-color: rgb(197, 197, 197);
  display: block;
  box-sizing: border-box;
}

:host([hidden]),
[hidden] {
  display: none !important;
}

*,
*::before,
*::after {
  box-sizing: inherit;
}

[aria-disabled=true] {
  opacity: 0.5;
  -webkit-user-select: none;
     -moz-user-select: none;
          user-select: none;
  pointer-events: none;
  cursor: default;
}

p {
  font-size: 1.5rem;
  min-width: 4.25rem;
  text-align: center;
  margin: auto;
  padding: 0.8333em;
  background-color: var(--_mark-color);
}

button {
  display: inline-block;
  min-width: 9.375rem;
  font: inherit;
  cursor: pointer;
  white-space: nowrap;
  border: none;
  color: rgb(245, 245, 245);
  background-color: rgb(51, 65, 85);
  padding: 0.75em;
}
button:first-child:not(:only-child) {
  margin-bottom: 1rem;
}

div {
  display: flex;
  align-items: center;
  max-width: 25rem;
  padding: 1em 2em;
  margin: auto;
  background-color: rgb(238, 238, 238);
  border: 0.0625rem solid var(--_mark-color);
  border-bottom: none;
}
div + div {
  border-top: 0.0625rem dashed var(--_mark-color);
  border-bottom: 0.0625rem solid var(--_mark-color);
}

span {
  display: flex;
  flex-direction: column;
  margin-right: 2rem;
}

::slotted(*) {
  white-space: nowrap;
}`;var w,j;class Q extends Ut{constructor(){super();at(this,w);this._xstate={},this.counterController=new Ze(this,Ne,"_xstate")}updated(n){if(super.updated&&super.updated(n),n.has("_xstate")){const{context:s,value:i}=this._xstate,r=new CustomEvent("counterchange",{bubbles:!0,detail:{...s,value:i}});this.dispatchEvent(r)}}render(){return Kt`
      <slot></slot>
      <div aria-disabled="${M(this,w,j)}">
        <span>
          <button
            ?disabled="${M(this,w,j)}"
            data-counter="increment"
            @click=${()=>this.counterController.send({type:"INC"})}
          >
            Increment
          </button>
          <button
            ?disabled="${M(this,w,j)}"
            data-counter="decrement"
            @click=${()=>this.counterController.send({type:"DEC"})}
          >
            Decrement
          </button>
        </span>
        <p>${this.counterController.state.context.counter}</p>
      </div>
      <div>
        <button @click=${()=>this.counterController.send({type:"TOGGLE"})}>
          ${M(this,w,j)?"Enabled counter":"Disabled counter"}
        </button>
      </div>
    `}}w=new WeakSet,j=function(){return this.counterController.state.matches("disabled")},U(Q,"properties",{_xstate:{type:Object,state:!0}}),U(Q,"styles",[tn]);window.customElements.define("xstate-counter",Q);
