var qt=Object.defineProperty;var Yt=(n,t,e)=>t in n?qt(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var Y=(n,t,e)=>(Yt(n,typeof t!="symbol"?t+"":t,e),e),Kt=(n,t,e)=>{if(!t.has(n))throw TypeError("Cannot "+e)};var R=(n,t,e)=>(Kt(n,t,"read from private field"),e?e.call(n):t.get(n)),ut=(n,t,e)=>{if(t.has(n))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(n):t.set(n,e)};import{i as Pt,s as Xt,x as Zt}from"./lit-element-CH2uaVH_.js";function Ht(){if(typeof globalThis<"u")return globalThis;if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global}function Ft(){const n=Ht();if(n.__xstate__)return n.__xstate__}const Nt=n=>{if(typeof window>"u")return;const t=Ft();t&&t.register(n)};class dt{constructor(t){this._process=t,this._active=!1,this._current=null,this._last=null}start(){this._active=!0,this.flush()}clear(){this._current&&(this._current.next=null,this._last=this._current)}enqueue(t){const e={value:t,next:null};if(this._current){this._last.next=e,this._last=e;return}this._current=e,this._last=e,this._active&&this.flush()}flush(){for(;this._current;){const t=this._current;this._process(t.value),this._current=t.next}this._last=null}}const wt=".",Qt="",Et="",Vt="#",te="*",Tt="xstate.init",X="xstate.stop";function ee(n,t){return{type:`xstate.after.${n}.${t}`}}function Z(n,t){return{type:`xstate.done.state.${n}`,output:t}}function ne(n,t){return{type:`xstate.done.actor.${n}`,output:t}}function se(n,t){return{type:`xstate.error.actor.${n}`,error:t}}function kt(n){return{type:Tt,input:n}}function _(n){setTimeout(()=>{throw n})}const ie=typeof Symbol=="function"&&Symbol.observable||"@@observable";function ft(n,t){return`${n.sessionId}.${t}`}let re=0;function oe(n,t){var y;const e=new Map,s=new Map,i=new WeakMap,r=new Set,o={},{clock:c,logger:a}=t,h={schedule:(l,f,p,g,v=Math.random().toString(36).slice(2))=>{const j={source:l,target:f,event:p,delay:g,id:v,startedAt:Date.now()},b=ft(l,v);u._snapshot._scheduledEvents[b]=j;const Wt=c.setTimeout(()=>{delete o[b],delete u._snapshot._scheduledEvents[b],u._relay(l,f,p)},g);o[b]=Wt},cancel:(l,f)=>{const p=ft(l,f),g=o[p];delete o[p],delete u._snapshot._scheduledEvents[p],c.clearTimeout(g)},cancelAll:l=>{for(const f in u._snapshot._scheduledEvents){const p=u._snapshot._scheduledEvents[f];p.source===l&&h.cancel(l,p.id)}}},d=l=>{if(!r.size)return;const f={...l,rootId:n.sessionId};r.forEach(p=>{var g;return(g=p.next)==null?void 0:g.call(p,f)})},u={_snapshot:{_scheduledEvents:(y=(t==null?void 0:t.snapshot)&&t.snapshot.scheduler)!=null?y:{}},_bookId:()=>`x:${re++}`,_register:(l,f)=>(e.set(l,f),l),_unregister:l=>{e.delete(l.sessionId);const f=i.get(l);f!==void 0&&(s.delete(f),i.delete(l))},get:l=>s.get(l),_set:(l,f)=>{const p=s.get(l);if(p&&p!==f)throw new Error(`Actor with system ID '${l}' already exists.`);s.set(l,f),i.set(f,l)},inspect:l=>{r.add(l)},_sendInspectionEvent:d,_relay:(l,f,p)=>{u._sendInspectionEvent({type:"@xstate.event",sourceRef:l,actorRef:f,event:p}),f._send(p)},scheduler:h,getSnapshot:()=>({_scheduledEvents:{...u._snapshot._scheduledEvents}}),start:()=>{const l=u._snapshot._scheduledEvents;u._snapshot._scheduledEvents={};for(const f in l){const{source:p,target:g,event:v,delay:j,id:b}=l[f];h.schedule(p,g,v,j,b)}},_clock:c,_logger:a};return u}function It(n,t){const e=lt(n),s=lt(t);return typeof s=="string"?typeof e=="string"?s===e:!1:typeof e=="string"?e in s:Object.keys(e).every(i=>i in s?It(e[i],s[i]):!1)}function tt(n){if(At(n))return n;let t=[],e="";for(let s=0;s<n.length;s++){switch(n.charCodeAt(s)){case 92:e+=n[s+1],s++;continue;case 46:t.push(e),e="";continue}e+=n[s]}return t.push(e),t}function lt(n){if(Le(n))return n.value;if(typeof n!="string")return n;const t=tt(n);return ce(t)}function ce(n){if(n.length===1)return n[0];const t={};let e=t;for(let s=0;s<n.length-1;s++)if(s===n.length-2)e[n[s]]=n[s+1];else{const i=e;e={},i[n[s]]=e}return t}function pt(n,t){const e={},s=Object.keys(n);for(let i=0;i<s.length;i++){const r=s[i];e[r]=t(n[r],r,n,i)}return e}function $t(n){return At(n)?n:[n]}function S(n){return n===void 0?[]:$t(n)}function H(n,t,e,s){return typeof n=="function"?n({context:t,event:e,self:s}):n}function At(n){return Array.isArray(n)}function ae(n){return n.type.startsWith("xstate.error.actor")}function $(n){return $t(n).map(t=>typeof t>"u"||typeof t=="string"?{target:t}:t)}function Ct(n){if(!(n===void 0||n===Qt))return S(n)}function yt(n,t,e){var r,o,c;const s=typeof n=="object",i=s?n:void 0;return{next:(r=s?n.next:n)==null?void 0:r.bind(i),error:(o=s?n.error:t)==null?void 0:o.bind(i),complete:(c=s?n.complete:e)==null?void 0:c.bind(i)}}function gt(n,t){return`${t}.${n}`}function et(n,t){const e=t.match(/^xstate\.invoke\.(\d+)\.(.*)/);if(!e)return n.implementations.actors[t];const[,s,i]=e,o=n.getStateNodeById(i).config.invoke;return(Array.isArray(o)?o[s]:o).src}const nt=1;let m=function(n){return n[n.NotStarted=0]="NotStarted",n[n.Running=1]="Running",n[n.Stopped=2]="Stopped",n}({});const he={clock:{setTimeout:(n,t)=>setTimeout(n,t),clearTimeout:n=>clearTimeout(n)},logger:console.log.bind(console),devTools:!1};class ue{constructor(t,e){var u,y,l,f;this.logic=t,this._snapshot=void 0,this.clock=void 0,this.options=void 0,this.id=void 0,this.mailbox=new dt(this._process.bind(this)),this.observers=new Set,this.eventListeners=new Map,this.logger=void 0,this._processingStatus=m.NotStarted,this._parent=void 0,this._syncSnapshot=void 0,this.ref=void 0,this._actorScope=void 0,this._systemId=void 0,this.sessionId=void 0,this.system=void 0,this._doneEvent=void 0,this.src=void 0,this._deferred=[];const s={...he,...e},{clock:i,logger:r,parent:o,syncSnapshot:c,id:a,systemId:h,inspect:d}=s;this.system=o?o.system:oe(this,{clock:i,logger:r}),d&&!o&&this.system.inspect(yt(d)),this.sessionId=this.system._bookId(),this.id=a!=null?a:this.sessionId,this.logger=(u=e==null?void 0:e.logger)!=null?u:this.system._logger,this.clock=(y=e==null?void 0:e.clock)!=null?y:this.system._clock,this._parent=o,this._syncSnapshot=c,this.options=s,this.src=(l=s.src)!=null?l:t,this.ref=this,this._actorScope={self:this,id:this.id,sessionId:this.sessionId,logger:this.logger,defer:p=>{this._deferred.push(p)},system:this.system,stopChild:p=>{if(p._parent!==this)throw new Error(`Cannot stop child actor ${p.id} of ${this.id} because it is not a child`);p._stop()},emit:p=>{const g=this.eventListeners.get(p.type),v=this.eventListeners.get("*");if(!g&&!v)return;const j=new Set([...g?g.values():[],...v?v.values():[]]);for(const b of Array.from(j))b(p)}},this.send=this.send.bind(this),this.system._sendInspectionEvent({type:"@xstate.actor",actorRef:this}),h&&(this._systemId=h,this.system._set(h,this)),this._initState((f=e==null?void 0:e.snapshot)!=null?f:e==null?void 0:e.state),h&&this._snapshot.status!=="active"&&this.system._unregister(this)}_initState(t){var e;try{this._snapshot=t?this.logic.restoreSnapshot?this.logic.restoreSnapshot(t,this._actorScope):t:this.logic.getInitialSnapshot(this._actorScope,(e=this.options)==null?void 0:e.input)}catch(s){this._snapshot={status:"error",output:void 0,error:s}}}update(t,e){var i,r;this._snapshot=t;let s;for(;s=this._deferred.shift();)try{s()}catch(o){this._deferred.length=0,this._snapshot={...t,status:"error",error:o}}switch(this._snapshot.status){case"active":for(const o of this.observers)try{(i=o.next)==null||i.call(o,t)}catch(c){_(c)}break;case"done":for(const o of this.observers)try{(r=o.next)==null||r.call(o,t)}catch(c){_(c)}this._stopProcedure(),this._complete(),this._doneEvent=ne(this.id,this._snapshot.output),this._parent&&this.system._relay(this,this._parent,this._doneEvent);break;case"error":this._error(this._snapshot.error);break}this.system._sendInspectionEvent({type:"@xstate.snapshot",actorRef:this,event:e,snapshot:t})}subscribe(t,e,s){var r;const i=yt(t,e,s);if(this._processingStatus!==m.Stopped)this.observers.add(i);else switch(this._snapshot.status){case"done":try{(r=i.complete)==null||r.call(i)}catch(o){_(o)}break;case"error":{const o=this._snapshot.error;if(!i.error)_(o);else try{i.error(o)}catch(c){_(c)}break}}return{unsubscribe:()=>{this.observers.delete(i)}}}on(t,e){let s=this.eventListeners.get(t);s||(s=new Set,this.eventListeners.set(t,s));const i=e.bind(void 0);return s.add(i),{unsubscribe:()=>{s.delete(i)}}}start(){if(this._processingStatus===m.Running)return this;this._syncSnapshot&&this.subscribe({next:s=>{s.status==="active"&&this.system._relay(this,this._parent,{type:`xstate.snapshot.${this.id}`,snapshot:s})},error:()=>{}}),this.system._register(this.sessionId,this),this._systemId&&this.system._set(this._systemId,this),this._processingStatus=m.Running;const t=kt(this.options.input);switch(this.system._sendInspectionEvent({type:"@xstate.event",sourceRef:this._parent,actorRef:this,event:t}),this._snapshot.status){case"done":return this.update(this._snapshot,t),this;case"error":return this._error(this._snapshot.error),this}if(this._parent||this.system.start(),this.logic.start)try{this.logic.start(this._snapshot,this._actorScope)}catch(s){return this._snapshot={...this._snapshot,status:"error",error:s},this._error(s),this}return this.update(this._snapshot,t),this.options.devTools&&this.attachDevTools(),this.mailbox.start(),this}_process(t){let e,s;try{e=this.logic.transition(this._snapshot,t,this._actorScope)}catch(i){s={err:i}}if(s){const{err:i}=s;this._snapshot={...this._snapshot,status:"error",error:i},this._error(i);return}this.update(e,t),t.type===X&&(this._stopProcedure(),this._complete())}_stop(){return this._processingStatus===m.Stopped?this:(this.mailbox.clear(),this._processingStatus===m.NotStarted?(this._processingStatus=m.Stopped,this):(this.mailbox.enqueue({type:X}),this))}stop(){if(this._parent)throw new Error("A non-root actor cannot be stopped directly.");return this._stop()}_complete(){var t;for(const e of this.observers)try{(t=e.complete)==null||t.call(e)}catch(s){_(s)}this.observers.clear()}_reportError(t){if(!this.observers.size){this._parent||_(t);return}let e=!1;for(const s of this.observers){const i=s.error;e||(e=!i);try{i==null||i(t)}catch(r){_(r)}}this.observers.clear(),e&&_(t)}_error(t){this._stopProcedure(),this._reportError(t),this._parent&&this.system._relay(this,this._parent,se(this.id,t))}_stopProcedure(){return this._processingStatus!==m.Running?this:(this.system.scheduler.cancelAll(this),this.mailbox.clear(),this.mailbox=new dt(this._process.bind(this)),this._processingStatus=m.Stopped,this.system._unregister(this),this)}_send(t){this._processingStatus!==m.Stopped&&this.mailbox.enqueue(t)}send(t){this.system._relay(void 0,this,t)}attachDevTools(){const{devTools:t}=this.options;t&&(typeof t=="function"?t:Nt)(this)}toJSON(){return{xstate$$type:nt,id:this.id}}getPersistedSnapshot(t){return this.logic.getPersistedSnapshot(this._snapshot,t)}[ie](){return this}getSnapshot(){return this._snapshot}}function L(n,...[t]){return new ue(n,t)}function de(n,t,e,s,{sendId:i}){const r=typeof i=="function"?i(e,s):i;return[t,r]}function fe(n,t){n.defer(()=>{n.system.scheduler.cancel(n.self,t)})}function le(n){function t(e,s){}return t.type="xstate.cancel",t.sendId=n,t.resolve=de,t.execute=fe,t}function pe(n,t,e,s,{id:i,systemId:r,src:o,input:c,syncSnapshot:a}){const h=typeof o=="string"?et(t.machine,o):o,d=typeof i=="function"?i(e):i;let u;return h&&(u=L(h,{id:d,src:o,parent:n.self,syncSnapshot:a,systemId:r,input:typeof c=="function"?c({context:t.context,event:e.event,self:n.self}):c})),[k(t,{children:{...t.children,[d]:u}}),{id:i,actorRef:u}]}function ye(n,{id:t,actorRef:e}){e&&n.defer(()=>{e._processingStatus!==m.Stopped&&e.start()})}function ge(...[n,{id:t,systemId:e,input:s,syncSnapshot:i=!1}={}]){function r(o,c){}return r.type="snapshot.spawnChild",r.id=t,r.systemId=e,r.src=n,r.input=s,r.syncSnapshot=i,r.resolve=pe,r.execute=ye,r}function me(n,t,e,s,{actorRef:i}){const r=typeof i=="function"?i(e,s):i,o=typeof r=="string"?t.children[r]:r;let c=t.children;return o&&(c={...c},delete c[o.id]),[k(t,{children:c}),o]}function ve(n,t){if(t){if(n.system._unregister(t),t._processingStatus!==m.Running){n.stopChild(t);return}n.defer(()=>{n.stopChild(t)})}}function Ot(n){function t(e,s){}return t.type="xstate.stopChild",t.actorRef=n,t.resolve=me,t.execute=ve,t}function st(n,t,e,s){const{machine:i}=s,r=typeof n=="function",o=r?n:i.implementations.guards[typeof n=="string"?n:n.type];if(!r&&!o)throw new Error(`Guard '${typeof n=="string"?n:n.type}' is not implemented.'.`);if(typeof o!="function")return st(o,t,e,s);const c={context:t,event:e},a=r||typeof n=="string"?void 0:"params"in n?typeof n.params=="function"?n.params({context:t,event:e}):n.params:void 0;return"check"in o?o.check(s,c,o):o(c,a)}const it=n=>n.type==="atomic"||n.type==="final";function C(n){return Object.values(n.states).filter(t=>t.type!=="history")}function J(n,t){const e=[];if(t===n)return e;let s=n.parent;for(;s&&s!==t;)e.push(s),s=s.parent;return e}function B(n){const t=new Set(n),e=jt(t);for(const s of t)if(s.type==="compound"&&(!e.get(s)||!e.get(s).length))mt(s).forEach(i=>t.add(i));else if(s.type==="parallel"){for(const i of C(s))if(i.type!=="history"&&!t.has(i)){const r=mt(i);for(const o of r)t.add(o)}}for(const s of t){let i=s.parent;for(;i;)t.add(i),i=i.parent}return t}function Mt(n,t){const e=t.get(n);if(!e)return{};if(n.type==="compound"){const i=e[0];if(i){if(it(i))return i.key}else return{}}const s={};for(const i of e)s[i.key]=Mt(i,t);return s}function jt(n){const t=new Map;for(const e of n)t.has(e)||t.set(e,[]),e.parent&&(t.has(e.parent)||t.set(e.parent,[]),t.get(e.parent).push(e));return t}function Rt(n,t){const e=B(t);return Mt(n,jt(e))}function rt(n,t){return t.type==="compound"?C(t).some(e=>e.type==="final"&&n.has(e)):t.type==="parallel"?C(t).every(e=>rt(n,e)):t.type==="final"}const q=n=>n[0]===Vt;function _e(n,t){return n.transitions.get(t)||[...n.transitions.keys()].filter(s=>{if(s===te)return!0;if(!s.endsWith(".*"))return!1;const i=s.split("."),r=t.split(".");for(let o=0;o<i.length;o++){const c=i[o],a=r[o];if(c==="*")return o===i.length-1;if(c!==a)return!1}return!0}).sort((s,i)=>i.length-s.length).flatMap(s=>n.transitions.get(s))}function be(n){const t=n.config.after;if(!t)return[];const e=(i,r)=>{const o=ee(i,n.id),c=o.type;return n.entry.push(Pe(o,{id:c,delay:i})),n.exit.push(le(c)),c};return Object.keys(t).flatMap((i,r)=>{const o=t[i],c=typeof o=="string"?{target:o}:o,a=Number.isNaN(+i)?i:+i,h=e(a);return S(c).map(d=>({...d,event:h,delay:a}))}).map(i=>{const{delay:r}=i;return{...w(n,i.event,i),delay:r}})}function w(n,t,e){var c;const s=Ct(e.target),i=(c=e.reenter)!=null?c:!1,r=we(n,s),o={...e,actions:S(e.actions),guard:e.guard,target:r,source:n,reenter:i,eventType:t,toJSON:()=>({...o,source:`#${n.id}`,target:r?r.map(a=>`#${a.id}`):void 0})};return o}function Se(n){const t=new Map;if(n.config.on)for(const e of Object.keys(n.config.on)){if(e===Et)throw new Error('Null events ("") cannot be specified as a transition key. Use `always: { ... }` instead.');const s=n.config.on[e];t.set(e,$(s).map(i=>w(n,e,i)))}if(n.config.onDone){const e=`xstate.done.state.${n.id}`;t.set(e,$(n.config.onDone).map(s=>w(n,e,s)))}for(const e of n.invoke){if(e.onDone){const s=`xstate.done.actor.${e.id}`;t.set(s,$(e.onDone).map(i=>w(n,s,i)))}if(e.onError){const s=`xstate.error.actor.${e.id}`;t.set(s,$(e.onError).map(i=>w(n,s,i)))}if(e.onSnapshot){const s=`xstate.snapshot.${e.id}`;t.set(s,$(e.onSnapshot).map(i=>w(n,s,i)))}}for(const e of n.after){let s=t.get(e.eventType);s||(s=[],t.set(e.eventType,s)),s.push(e)}return t}function xe(n,t){const e=typeof t=="string"?n.states[t]:t?n.states[t.target]:void 0;if(!e&&t)throw new Error(`Initial state node "${t}" not found on parent state node #${n.id}`);const s={source:n,actions:!t||typeof t=="string"?[]:S(t.actions),eventType:null,reenter:!1,target:e?[e]:[],toJSON:()=>({...s,source:`#${n.id}`,target:e?[`#${e.id}`]:[]})};return s}function we(n,t){if(t!==void 0)return t.map(e=>{if(typeof e!="string")return e;if(q(e))return n.machine.getStateNodeById(e);const s=e[0]===wt;if(s&&!n.parent)return U(n,e.slice(1));const i=s?n.key+e:e;if(n.parent)try{return U(n.parent,i)}catch(r){throw new Error(`Invalid transition definition for state node '${n.id}':
${r.message}`)}else throw new Error(`Invalid target: "${e}" is not a valid target from the root node. Did you mean ".${e}"?`)})}function Dt(n){const t=Ct(n.config.target);return t?{target:t.map(e=>typeof e=="string"?U(n.parent,e):e)}:n.parent.initial}function E(n){return n.type==="history"}function mt(n){const t=zt(n);for(const e of t)for(const s of J(e,n))t.add(s);return t}function zt(n){const t=new Set;function e(s){if(!t.has(s)){if(t.add(s),s.type==="compound")e(s.initial.target[0]);else if(s.type==="parallel")for(const i of C(s))e(i)}}return e(n),t}function O(n,t){if(q(t))return n.machine.getStateNodeById(t);if(!n.states)throw new Error(`Unable to retrieve child state '${t}' from '${n.id}'; no child states exist.`);const e=n.states[t];if(!e)throw new Error(`Child state '${t}' does not exist on '${n.id}'`);return e}function U(n,t){if(typeof t=="string"&&q(t))try{return n.machine.getStateNodeById(t)}catch{}const e=tt(t).slice();let s=n;for(;e.length;){const i=e.shift();if(!i.length)break;s=O(s,i)}return s}function W(n,t){if(typeof t=="string"){const i=n.states[t];if(!i)throw new Error(`State '${t}' does not exist on '${n.id}'`);return[n,i]}const e=Object.keys(t),s=e.map(i=>O(n,i)).filter(Boolean);return[n.machine.root,n].concat(s,e.reduce((i,r)=>{const o=O(n,r);if(!o)return i;const c=W(o,t[r]);return i.concat(c)},[]))}function Ee(n,t,e,s){const r=O(n,t).next(e,s);return!r||!r.length?n.next(e,s):r}function Te(n,t,e,s){const i=Object.keys(t),r=O(n,i[0]),o=ot(r,t[i[0]],e,s);return!o||!o.length?n.next(e,s):o}function ke(n,t,e,s){const i=[];for(const r of Object.keys(t)){const o=t[r];if(!o)continue;const c=O(n,r),a=ot(c,o,e,s);a&&i.push(...a)}return i.length?i:n.next(e,s)}function ot(n,t,e,s){return typeof t=="string"?Ee(n,t,e,s):Object.keys(t).length===1?Te(n,t,e,s):ke(n,t,e,s)}function Ie(n){return Object.keys(n.states).map(t=>n.states[t]).filter(t=>t.type==="history")}function x(n,t){let e=n;for(;e.parent&&e.parent!==t;)e=e.parent;return e.parent===t}function $e(n,t){const e=new Set(n),s=new Set(t);for(const i of e)if(s.has(i))return!0;for(const i of s)if(e.has(i))return!0;return!1}function Lt(n,t,e){const s=new Set;for(const i of n){let r=!1;const o=new Set;for(const c of s)if($e(F([i],t,e),F([c],t,e)))if(x(i.source,c.source))o.add(c);else{r=!0;break}if(!r){for(const c of o)s.delete(c);s.add(i)}}return Array.from(s)}function Ae(n){const[t,...e]=n;for(const s of J(t,void 0))if(e.every(i=>x(i,s)))return s}function ct(n,t){if(!n.target)return[];const e=new Set;for(const s of n.target)if(E(s))if(t[s.id])for(const i of t[s.id])e.add(i);else for(const i of ct(Dt(s),t))e.add(i);else e.add(s);return[...e]}function Jt(n,t){const e=ct(n,t);if(!e)return;if(!n.reenter&&e.every(i=>i===n.source||x(i,n.source)))return n.source;const s=Ae(e.concat(n.source));if(s)return s;if(!n.reenter)return n.source.machine.root}function F(n,t,e){var i;const s=new Set;for(const r of n)if((i=r.target)!=null&&i.length){const o=Jt(r,e);r.reenter&&r.source===o&&s.add(o);for(const c of t)x(c,o)&&s.add(c)}return[...s]}function Ce(n,t){if(n.length!==t.size)return!1;for(const e of n)if(!t.has(e))return!1;return!0}function N(n,t,e,s,i,r){if(!n.length)return t;const o=new Set(t._nodes);let c=t.historyValue;const a=Lt(n,o,c);let h=t;i||([h,c]=Re(h,s,e,a,o,c,r)),h=M(h,s,e,a.flatMap(u=>u.actions),r),h=Me(h,s,e,a,o,r,c,i);const d=[...o];h.status==="done"&&(h=M(h,s,e,d.sort((u,y)=>y.order-u.order).flatMap(u=>u.exit),r));try{return c===t.historyValue&&Ce(t._nodes,o)?h:k(h,{_nodes:d,historyValue:c})}catch(u){throw u}}function Oe(n,t,e,s,i){if(s.output===void 0)return;const r=Z(i.id,i.output!==void 0&&i.parent?H(i.output,n.context,t,e.self):void 0);return H(s.output,n.context,r,e.self)}function Me(n,t,e,s,i,r,o,c){let a=n;const h=new Set,d=new Set;je(s,o,d,h),c&&d.add(n.machine.root);const u=new Set;for(const y of[...h].sort((l,f)=>l.order-f.order)){i.add(y);const l=[];l.push(...y.entry);for(const f of y.invoke)l.push(ge(f.src,{...f,syncSnapshot:!!f.onSnapshot}));if(d.has(y)){const f=y.initial.actions;l.push(...f)}if(a=M(a,t,e,l,r,y.invoke.map(f=>f.id)),y.type==="final"){const f=y.parent;let p=(f==null?void 0:f.type)==="parallel"?f:f==null?void 0:f.parent,g=p||y;for((f==null?void 0:f.type)==="compound"&&r.push(Z(f.id,y.output!==void 0?H(y.output,a.context,t,e.self):void 0));(p==null?void 0:p.type)==="parallel"&&!u.has(p)&&rt(i,p);)u.add(p),r.push(Z(p.id)),g=p,p=p.parent;if(p)continue;a=k(a,{status:"done",output:Oe(a,t,e,a.machine.root,g)})}}return a}function je(n,t,e,s){for(const i of n){const r=Jt(i,t);for(const c of i.target||[])!E(c)&&(i.source!==c||i.source!==r||i.reenter)&&(s.add(c),e.add(c)),A(c,t,e,s);const o=ct(i,t);for(const c of o){const a=J(c,r);(r==null?void 0:r.type)==="parallel"&&a.push(r),Gt(s,t,e,a,!i.source.parent&&i.reenter?void 0:r)}}}function A(n,t,e,s){var i;if(E(n))if(t[n.id]){const r=t[n.id];for(const o of r)s.add(o),A(o,t,e,s);for(const o of r)K(o,n.parent,s,t,e)}else{const r=Dt(n);for(const o of r.target)s.add(o),r===((i=n.parent)==null?void 0:i.initial)&&e.add(n.parent),A(o,t,e,s);for(const o of r.target)K(o,n.parent,s,t,e)}else if(n.type==="compound"){const[r]=n.initial.target;E(r)||(s.add(r),e.add(r)),A(r,t,e,s),K(r,n,s,t,e)}else if(n.type==="parallel")for(const r of C(n).filter(o=>!E(o)))[...s].some(o=>x(o,r))||(E(r)||(s.add(r),e.add(r)),A(r,t,e,s))}function Gt(n,t,e,s,i){for(const r of s)if((!i||x(r,i))&&n.add(r),r.type==="parallel")for(const o of C(r).filter(c=>!E(c)))[...n].some(c=>x(c,o))||(n.add(o),A(o,t,e,n))}function K(n,t,e,s,i){Gt(e,s,i,J(n,t))}function Re(n,t,e,s,i,r,o){let c=n;const a=F(s,i,r);a.sort((d,u)=>u.order-d.order);let h;for(const d of a)for(const u of Ie(d)){let y;u.history==="deep"?y=l=>it(l)&&x(l,d):y=l=>l.parent===d,h!=null||(h={...r}),h[u.id]=Array.from(i).filter(y)}for(const d of a)c=M(c,t,e,[...d.exit,...d.invoke.map(u=>Ot(u.id))],o),i.delete(d);return[c,h||r]}let vt=!1;function Bt(n,t,e,s,i,r){const{machine:o}=n;let c=n;for(const a of s){let l=function(){e.system._sendInspectionEvent({type:"@xstate.action",actorRef:e.self,action:{type:typeof a=="string"?a:typeof a=="object"?a.type:a.name||"(anonymous)",params:y}});try{vt=d,d(u,y)}finally{vt=!1}};const h=typeof a=="function",d=h?a:o.implementations.actions[typeof a=="string"?a:a.type];if(!d)continue;const u={context:c.context,event:t,self:e.self,system:e.system},y=h||typeof a=="string"?void 0:"params"in a?typeof a.params=="function"?a.params({context:c.context,event:t}):a.params:void 0;if(!("resolve"in d)){e.self._processingStatus===m.Running?l():e.defer(()=>{l()});continue}const f=d,[p,g,v]=f.resolve(e,c,u,y,d,i);c=p,"retryResolve"in f&&(r==null||r.push([f,g])),"execute"in f&&(e.self._processingStatus===m.Running?f.execute(e,g):e.defer(f.execute.bind(null,e,g))),v&&(c=Bt(c,t,e,v,i,r))}return c}function M(n,t,e,s,i,r){const o=r?[]:void 0,c=Bt(n,t,e,s,{internalQueue:i,deferredActorIds:r},o);return o==null||o.forEach(([a,h])=>{a.retryResolve(e,c,h)}),c}function P(n,t,e,s=[]){let i=n;const r=[];function o(h,d,u){e.system._sendInspectionEvent({type:"@xstate.microstep",actorRef:e.self,event:d,snapshot:h,_transitions:u}),r.push(h)}if(t.type===X)return i=k(_t(i,t,e),{status:"stopped"}),o(i,t,[]),{snapshot:i,microstates:r};let c=t;if(c.type!==Tt){const h=c,d=ae(h),u=bt(h,i);if(d&&!u.length)return i=k(n,{status:"error",error:h.error}),o(i,h,[]),{snapshot:i,microstates:r};i=N(u,n,e,c,!1,s),o(i,h,u)}let a=!0;for(;i.status==="active";){let h=a?De(i,c):[];const d=h.length?i:void 0;if(!h.length){if(!s.length)break;c=s.shift(),h=bt(c,i)}i=N(h,i,e,c,!1,s),a=i!==d,o(i,c,h)}return i.status!=="active"&&_t(i,c,e),{snapshot:i,microstates:r}}function _t(n,t,e){return M(n,t,e,Object.values(n.children).map(s=>Ot(s)),[])}function bt(n,t){return t.machine.getTransitionData(t,n)}function De(n,t){const e=new Set,s=n._nodes.filter(it);for(const i of s)t:for(const r of[i].concat(J(i,void 0)))if(r.always){for(const o of r.always)if(o.guard===void 0||st(o.guard,n.context,t,n)){e.add(o);break t}}return Lt(Array.from(e),new Set(n._nodes),n.historyValue)}function ze(n,t){const e=B(W(n,t));return Rt(n,[...e])}function Le(n){return!!n&&typeof n=="object"&&"machine"in n&&"value"in n}const Je=function(t){return It(t,this.value)},Ge=function(t){return this.tags.has(t)},Be=function(t){const e=this.machine.getTransitionData(this,t);return!!(e!=null&&e.length)&&e.some(s=>s.target!==void 0||s.actions.length)},Ue=function(){const{_nodes:t,tags:e,machine:s,getMeta:i,toJSON:r,can:o,hasTag:c,matches:a,...h}=this;return{...h,tags:Array.from(e)}},We=function(){return this._nodes.reduce((t,e)=>(e.meta!==void 0&&(t[e.id]=e.meta),t),{})};function G(n,t){return{status:n.status,output:n.output,error:n.error,machine:t,context:n.context,_nodes:n._nodes,value:Rt(t.root,n._nodes),tags:new Set(n._nodes.flatMap(e=>e.tags)),children:n.children,historyValue:n.historyValue||{},matches:Je,hasTag:Ge,can:Be,getMeta:We,toJSON:Ue}}function k(n,t={}){return G({...n,...t},n.machine)}function qe(n,t){const{_nodes:e,tags:s,machine:i,children:r,context:o,can:c,hasTag:a,matches:h,getMeta:d,toJSON:u,...y}=n,l={};for(const p in r){const g=r[p];l[p]={snapshot:g.getPersistedSnapshot(t),src:g.src,systemId:g._systemId,syncSnapshot:g._syncSnapshot}}return{...y,context:Ut(o),children:l}}function Ut(n){let t;for(const e in n){const s=n[e];if(s&&typeof s=="object")if("sessionId"in s&&"send"in s&&"ref"in s)t!=null||(t=Array.isArray(n)?n.slice():{...n}),t[e]={xstate$$type:nt,id:s.id};else{const i=Ut(s);i!==s&&(t!=null||(t=Array.isArray(n)?n.slice():{...n}),t[e]=i)}}return t!=null?t:n}function Ye(n,t,e,s,{event:i,id:r,delay:o},{internalQueue:c}){const a=t.machine.implementations.delays;if(typeof i=="string")throw new Error(`Only event objects may be used with raise; use raise({ type: "${i}" }) instead`);const h=typeof i=="function"?i(e,s):i;let d;if(typeof o=="string"){const u=a&&a[o];d=typeof u=="function"?u(e,s):u}else d=typeof o=="function"?o(e,s):o;return typeof d!="number"&&c.push(h),[t,{event:h,id:r,delay:d}]}function Ke(n,t){const{event:e,delay:s,id:i}=t;if(typeof s=="number"){n.defer(()=>{const r=n.self;n.system.scheduler.schedule(r,r,e,s,i)});return}}function Pe(n,t){function e(s,i){}return e.type="xstate.raise",e.event=n,e.id=t==null?void 0:t.id,e.delay=t==null?void 0:t.delay,e.resolve=Ye,e.execute=Ke,e}function Xe(n,{machine:t,context:e},s,i){const r=(o,c={})=>{const{systemId:a,input:h}=c;if(typeof o=="string"){const d=et(t,o);if(!d)throw new Error(`Actor logic '${o}' not implemented in machine '${t.id}'`);const u=L(d,{id:c.id,parent:n.self,syncSnapshot:c.syncSnapshot,input:typeof h=="function"?h({context:e,event:s,self:n.self}):h,src:o,systemId:a});return i[u.id]=u,u}else return L(o,{id:c.id,parent:n.self,syncSnapshot:c.syncSnapshot,input:c.input,src:o,systemId:a})};return(o,c)=>{const a=r(o,c);return i[a.id]=a,n.defer(()=>{a._processingStatus!==m.Stopped&&a.start()}),a}}function Ze(n,t,e,s,{assignment:i}){if(!t.context)throw new Error("Cannot assign to undefined `context`. Ensure that `context` is defined in the machine config.");const r={},o={context:t.context,event:e.event,spawn:Xe(n,t,e.event,r),self:n.self,system:n.system};let c={};if(typeof i=="function")c=i(o,s);else for(const h of Object.keys(i)){const d=i[h];c[h]=typeof d=="function"?d(o,s):d}const a=Object.assign({},t.context,c);return[k(t,{context:a,children:Object.keys(r).length?{...t.children,...r}:t.children})]}function Q(n){function t(e,s){}return t.type="xstate.assign",t.assignment=n,t.resolve=Ze,t}const St=new WeakMap;function I(n,t,e){let s=St.get(n);return s?t in s||(s[t]=e()):(s={[t]:e()},St.set(n,s)),s[t]}const He={},D=n=>typeof n=="string"?{type:n}:typeof n=="function"?"resolve"in n?{type:n.type}:{type:n.name}:n;class at{constructor(t,e){if(this.config=t,this.key=void 0,this.id=void 0,this.type=void 0,this.path=void 0,this.states=void 0,this.history=void 0,this.entry=void 0,this.exit=void 0,this.parent=void 0,this.machine=void 0,this.meta=void 0,this.output=void 0,this.order=-1,this.description=void 0,this.tags=[],this.transitions=void 0,this.always=void 0,this.parent=e._parent,this.key=e._key,this.machine=e._machine,this.path=this.parent?this.parent.path.concat(this.key):[],this.id=this.config.id||[this.machine.id,...this.path].join(wt),this.type=this.config.type||(this.config.states&&Object.keys(this.config.states).length?"compound":this.config.history?"history":"atomic"),this.description=this.config.description,this.order=this.machine.idMap.size,this.machine.idMap.set(this.id,this),this.states=this.config.states?pt(this.config.states,(s,i)=>new at(s,{_parent:this,_key:i,_machine:this.machine})):He,this.type==="compound"&&!this.config.initial)throw new Error(`No initial state specified for compound state node "#${this.id}". Try adding { initial: "${Object.keys(this.states)[0]}" } to the state config.`);this.history=this.config.history===!0?"shallow":this.config.history||!1,this.entry=S(this.config.entry).slice(),this.exit=S(this.config.exit).slice(),this.meta=this.config.meta,this.output=this.type==="final"||!this.parent?this.config.output:void 0,this.tags=S(t.tags).slice()}_initialize(){this.transitions=Se(this),this.config.always&&(this.always=$(this.config.always).map(t=>w(this,Et,t))),Object.keys(this.states).forEach(t=>{this.states[t]._initialize()})}get definition(){return{id:this.id,key:this.key,version:this.machine.version,type:this.type,initial:this.initial?{target:this.initial.target,source:this,actions:this.initial.actions.map(D),eventType:null,reenter:!1,toJSON:()=>({target:this.initial.target.map(t=>`#${t.id}`),source:`#${this.id}`,actions:this.initial.actions.map(D),eventType:null})}:void 0,history:this.history,states:pt(this.states,t=>t.definition),on:this.on,transitions:[...this.transitions.values()].flat().map(t=>({...t,actions:t.actions.map(D)})),entry:this.entry.map(D),exit:this.exit.map(D),meta:this.meta,order:this.order||-1,output:this.output,invoke:this.invoke,description:this.description,tags:this.tags}}toJSON(){return this.definition}get invoke(){return I(this,"invoke",()=>S(this.config.invoke).map((t,e)=>{var c;const{src:s,systemId:i}=t,r=(c=t.id)!=null?c:gt(this.id,e),o=typeof s=="string"?s:`xstate.invoke.${gt(this.id,e)}`;return{...t,src:o,id:r,systemId:i,toJSON(){const{onDone:a,onError:h,...d}=t;return{...d,type:"xstate.invoke",src:o,id:r}}}}))}get on(){return I(this,"on",()=>[...this.transitions].flatMap(([e,s])=>s.map(i=>[e,i])).reduce((e,[s,i])=>(e[s]=e[s]||[],e[s].push(i),e),{}))}get after(){return I(this,"delayedTransitions",()=>be(this))}get initial(){return I(this,"initial",()=>xe(this,this.config.initial))}next(t,e){const s=e.type,i=[];let r;const o=I(this,`candidates-${s}`,()=>_e(this,s));for(const c of o){const{guard:a}=c,h=t.context;let d=!1;try{d=!a||st(a,h,e,t)}catch(u){const y=typeof a=="string"?a:typeof a=="object"?a.type:void 0;throw new Error(`Unable to evaluate guard ${y?`'${y}' `:""}in transition for event '${s}' in state node '${this.id}':
${u.message}`)}if(d){i.push(...c.actions),r=c;break}}return r?[r]:void 0}get events(){return I(this,"events",()=>{const{states:t}=this,e=new Set(this.ownEvents);if(t)for(const s of Object.keys(t)){const i=t[s];if(i.states)for(const r of i.events)e.add(`${r}`)}return Array.from(e)})}get ownEvents(){const t=new Set([...this.transitions.keys()].filter(e=>this.transitions.get(e).some(s=>!(!s.target&&!s.actions.length&&!s.reenter))));return Array.from(t)}}const Fe="#";class ht{constructor(t,e){var s,i,r,o;this.config=t,this.version=void 0,this.schemas=void 0,this.implementations=void 0,this.__xstatenode=!0,this.idMap=new Map,this.root=void 0,this.id=void 0,this.states=void 0,this.events=void 0,this.__TResolvedTypesMeta=void 0,this.id=t.id||"(machine)",this.implementations={actors:(s=e==null?void 0:e.actors)!=null?s:{},actions:(i=e==null?void 0:e.actions)!=null?i:{},delays:(r=e==null?void 0:e.delays)!=null?r:{},guards:(o=e==null?void 0:e.guards)!=null?o:{}},this.version=this.config.version,this.schemas=this.config.schemas,this.transition=this.transition.bind(this),this.getInitialSnapshot=this.getInitialSnapshot.bind(this),this.getPersistedSnapshot=this.getPersistedSnapshot.bind(this),this.restoreSnapshot=this.restoreSnapshot.bind(this),this.start=this.start.bind(this),this.root=new at(t,{_key:this.id,_machine:this}),this.root._initialize(),this.states=this.root.states,this.events=this.root.events}provide(t){const{actions:e,guards:s,actors:i,delays:r}=this.implementations;return new ht(this.config,{actions:{...e,...t.actions},guards:{...s,...t.guards},actors:{...i,...t.actors},delays:{...r,...t.delays}})}resolveState(t){const e=ze(this.root,t.value),s=B(W(this.root,e));return G({_nodes:[...s],context:t.context||{},children:{},status:rt(s,this.root)?"done":t.status||"active",output:t.output,error:t.error,historyValue:t.historyValue},this)}transition(t,e,s){return P(t,e,s).snapshot}microstep(t,e,s){return P(t,e,s).microstates}getTransitionData(t,e){return ot(this.root,t.value,t,e)||[]}getPreInitialState(t,e,s){const{context:i}=this.config,r=G({context:typeof i!="function"&&i?i:{},_nodes:[this.root],children:{},status:"active"},this);return typeof i=="function"?M(r,e,t,[Q(({spawn:c,event:a,self:h})=>i({spawn:c,input:a.input,self:h}))],s):r}getInitialSnapshot(t,e){const s=kt(e),i=[],r=this.getPreInitialState(t,s,i),o=N([{target:[...zt(this.root)],source:this.root,reenter:!0,actions:[],eventType:null,toJSON:null}],r,t,s,!0,i),{snapshot:c}=P(o,s,t,i);return c}start(t){Object.values(t.children).forEach(e=>{e.getSnapshot().status==="active"&&e.start()})}getStateNodeById(t){const e=tt(t),s=e.slice(1),i=q(e[0])?e[0].slice(Fe.length):e[0],r=this.idMap.get(i);if(!r)throw new Error(`Child state node '#${i}' does not exist on machine '${this.id}'`);return U(r,s)}get definition(){return this.root.definition}toJSON(){return this.definition}getPersistedSnapshot(t,e){return qe(t,e)}restoreSnapshot(t,e){const s={},i=t.children;Object.keys(i).forEach(a=>{const h=i[a],d=h.snapshot,u=h.src,y=typeof u=="string"?et(this,u):u;if(!y)return;const l=L(y,{id:a,parent:e.self,syncSnapshot:h.syncSnapshot,snapshot:d,src:u,systemId:h.systemId});s[a]=l});const r=G({...t,children:s,_nodes:Array.from(B(W(this.root,t.value)))},this);let o=new Set;function c(a,h){if(!o.has(a)){o.add(a);for(let d in a){const u=a[d];if(u&&typeof u=="object"){if("xstate$$type"in u&&u.xstate$$type===nt){a[d]=h[u.id];continue}c(u,h)}}}}return c(r.context,s),r}}function Ne(n,t){return new ht(n,t)}class Qe{constructor(t,{machine:e,options:s,callback:i}){this.machine=e,this.options=s,this.callback=i,this.currentSnapshot=this.snapshot,this.onNext=this.onNext.bind(this),(this.host=t).addController(this)}get actor(){return this.actorRef}get snapshot(){var t,e;return(e=(t=this.actorRef)==null?void 0:t.getSnapshot)==null?void 0:e.call(t)}send(t){var e;(e=this.actorRef)==null||e.send(t)}unsubscribe(){var t;(t=this.subs)==null||t.unsubscribe()}onNext(t){var e;this.currentSnapshot!==t&&(this.currentSnapshot=t,(e=this.callback)==null||e.call(this,t),this.host.requestUpdate())}startService(){var t;this.actorRef=L(this.machine,this.options),this.actorRef&&(this.subs=this.actorRef.subscribe(this.onNext)),(t=this.actorRef)==null||t.start()}stopService(){var t;(t=this.actorRef)==null||t.stop()}hostConnected(){this.startService()}hostDisconnected(){this.stopService()}}const xt={enabled:"enabled",disabled:"disabled"},Ve={counter:({context:n})=>n.counter+1,event:({event:n})=>n},tn={counter:({context:n})=>n.counter-1,event:({event:n})=>n},en=({context:n})=>n.counter<10,nn=({context:n})=>n.counter>0,sn=Ne({id:"counter",context:{counter:0,event:void 0},initial:"enabled",states:{enabled:{on:{INC:{actions:{type:"increment"},guard:{type:"isNotMax"}},DEC:{actions:{type:"decrement"},guard:{type:"isNotMin"}},TOGGLE:{target:xt.disabled}}},disabled:{on:{TOGGLE:{target:xt.enabled}}}}},{actions:{increment:Q(Ve),decrement:Q(tn)},guards:{isNotMax:en,isNotMin:nn}}),rn=Pt`:host {
  --_mark-color: rgb(197, 197, 197);
  display: block;
  box-sizing: border-box;
}

:host([hidden]),
[hidden] {
  display: none !important;
}

*,
*::before,
*::after {
  box-sizing: inherit;
}

[aria-disabled=true] {
  opacity: 0.5;
  -webkit-user-select: none;
     -moz-user-select: none;
          user-select: none;
  pointer-events: none;
  cursor: default;
}

p {
  font-size: 1.5rem;
  min-width: 4.25rem;
  text-align: center;
  margin: auto;
  padding: 0.8333em;
  background-color: var(--_mark-color);
}

button {
  display: inline-block;
  min-width: 9.375rem;
  font: inherit;
  cursor: pointer;
  white-space: nowrap;
  border: none;
  color: rgb(245, 245, 245);
  background-color: rgb(51, 65, 85);
  padding: 0.75em;
}
button:first-child:not(:only-child) {
  margin-bottom: 1rem;
}

div {
  display: flex;
  align-items: center;
  max-width: 25rem;
  padding: 1em 2em;
  margin: auto;
  background-color: rgb(238, 238, 238);
  border: 0.0625rem solid var(--_mark-color);
  border-bottom: none;
}
div + div {
  border-top: 0.0625rem dashed var(--_mark-color);
  border-bottom: 0.0625rem solid var(--_mark-color);
}

span {
  display: flex;
  flex-direction: column;
  margin-right: 2rem;
}

::slotted(*) {
  white-space: nowrap;
}`;var T,z;class V extends Xt{constructor(){super();ut(this,T);this._xstate={},this._inspectEvents=this._inspectEvents.bind(this),this._callbackCounterController=this._callbackCounterController.bind(this),this.counterController=new Qe(this,{machine:sn,options:{inspect:this._inspectEvents},callback:this._callbackCounterController})}_callbackCounterController(e){this._xstate=e}_inspectEvents(e){e.type==="@xstate.snapshot"&&e.event.type==="xstate.stop"&&(this._xstate={})}updated(e){if(super.updated&&super.updated(e),e.has("_xstate")){const{context:s,value:i}=this._xstate,r=new CustomEvent("counterchange",{bubbles:!0,detail:{...s,value:i}});this.dispatchEvent(r)}}render(){return Zt`
      <slot></slot>
      <div aria-disabled="${R(this,T,z)}">
        <span>
          <button
            ?disabled="${R(this,T,z)}"
            data-counter="increment"
            @click=${()=>this.counterController.send({type:"INC"})}
          >
            Increment
          </button>
          <button
            ?disabled="${R(this,T,z)}"
            data-counter="decrement"
            @click=${()=>this.counterController.send({type:"DEC"})}
          >
            Decrement
          </button>
        </span>
        <p>${this.counterController.snapshot.context.counter}</p>
      </div>
      <div>
        <button @click=${()=>this.counterController.send({type:"TOGGLE"})}>
          ${R(this,T,z)?"Enabled counter":"Disabled counter"}
        </button>
      </div>
    `}}T=new WeakSet,z=function(){return this.counterController.snapshot.matches("disabled")},Y(V,"properties",{_xstate:{type:Object,state:!0}}),Y(V,"styles",[rn]);window.customElements.define("xstate-counter",V);
