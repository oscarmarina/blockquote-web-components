var ee=Object.defineProperty;var te=(e,t,r)=>t in e?ee(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var c=(e,t,r)=>te(e,typeof t!="symbol"?t+"":t,r);const K=new WeakMap;function re(e,t){let r=t;for(;r;){if(K.get(r)===e)return!0;r=Object.getPrototypeOf(r)}return!1}function ne(e){return t=>{if(re(e,t))return t;const r=e(t);return K.set(r,e),r}}class U extends Error{constructor(r){super(r?`${r.length} errors occurred during unsubscription:
${r.map((n,i)=>`${i+1}) ${n.toString()}`).join(`
  `)}`:"");c(this,"errors");this.errors=r,this.name="UnsubscriptionError"}}const T=class T{constructor(t){c(this,"initialTeardown");c(this,"closed",!1);c(this,"_finalizers",null);this.initialTeardown=t}unsubscribe(){let t;if(!this.closed){this.closed=!0;const{initialTeardown:r}=this;if(m(r))try{r()}catch(i){t=i instanceof U?i.errors:[i]}const{_finalizers:n}=this;if(n){this._finalizers=null;for(const i of n)try{X(i)}catch(a){t=t!=null?t:[],a instanceof U?t.push(...a.errors):t.push(a)}}if(t)throw new U(t)}}add(t){var r;t&&t!==this&&(this.closed?X(t):(t&&"add"in t&&t.add(()=>{this.remove(t)}),(r=this._finalizers)!=null||(this._finalizers=new Set),this._finalizers.add(t)))}remove(t){var r;(r=this._finalizers)==null||r.delete(t)}};c(T,"EMPTY",(()=>{const t=new T;return t.closed=!0,t})());let v=T;typeof Symbol.dispose=="symbol"&&(v.prototype[Symbol.dispose]=v.prototype.unsubscribe);function X(e){m(e)?e():e.unsubscribe()}class R extends v{constructor(r,n){var i,a,o,l;super();c(this,"isStopped",!1);c(this,"destination");c(this,"_nextOverride",null);c(this,"_errorOverride",null);c(this,"_completeOverride",null);c(this,"_onFinalize",null);this.destination=r instanceof R?r:ce(r),this._nextOverride=(i=n==null?void 0:n.next)!=null?i:null,this._errorOverride=(a=n==null?void 0:n.error)!=null?a:null,this._completeOverride=(o=n==null?void 0:n.complete)!=null?o:null,this._onFinalize=(l=n==null?void 0:n.finalize)!=null?l:null,this._next=this._nextOverride?se:this._next,this._error=this._errorOverride?oe:this._error,this._complete=this._completeOverride?ie:this._complete,le(r)&&r.add(this)}next(r){this.isStopped||this._next(r)}error(r){this.isStopped||(this.isStopped=!0,this._error(r))}complete(){this.isStopped||(this.isStopped=!0,this._complete())}unsubscribe(){var r;this.closed||(this.isStopped=!0,super.unsubscribe(),(r=this._onFinalize)==null||r.call(this))}_next(r){this.destination.next(r)}_error(r){try{this.destination.error(r)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}function se(e){try{this._nextOverride(e)}catch(t){this.destination.error(t)}}function oe(e){try{this._errorOverride(e)}catch(t){this.destination.error(t)}finally{this.unsubscribe()}}function ie(){try{this._completeOverride()}catch(e){this.destination.error(e)}finally{this.unsubscribe()}}class ae{constructor(t){c(this,"partialObserver");this.partialObserver=t}next(t){const{partialObserver:r}=this;if(r.next)try{r.next(t)}catch(n){L(n)}}error(t){const{partialObserver:r}=this;if(r.error)try{r.error(t)}catch(n){L(n)}else L(t)}complete(){const{partialObserver:t}=this;if(t.complete)try{t.complete()}catch(r){L(r)}}}function ce(e){return new ae(!e||m(e)?{next:e!=null?e:void 0}:e)}function le(e){return e&&m(e.unsubscribe)&&m(e.add)}function F({destination:e,...t}){return new R(e,t)}var N;class x{constructor(t){t&&(this._subscribe=t)}subscribe(t){const r=t instanceof R?t:new R(t);return r.add(this._trySubscribe(r)),r}_trySubscribe(t){try{return this._subscribe(t)}catch(r){t.error(r)}}forEach(t){return new Promise((r,n)=>{const i=new R({next:a=>{try{t(a)}catch(o){n(o),i.unsubscribe()}},error:n,complete:r});this.subscribe(i)})}_subscribe(t){}[(N=Symbol.observable)!=null?N:"@@observable"](){return this}pipe(...t){return t.reduce(ue,this)}[Symbol.asyncIterator](){let t,r=!1,n,i=!1;const a=[],o=[],l=h=>{for(r=!0,n=h;o.length;){const[y,b]=o.shift();b(h)}},_=()=>{for(i=!0;o.length;){const[h]=o.shift();h({value:void 0,done:!0})}};return{next:()=>(t||(t=this.subscribe({next:h=>{if(o.length){const[y]=o.shift();y({value:h,done:!1})}else a.push(h)},error:l,complete:_})),a.length?Promise.resolve({value:a.shift(),done:!1}):i?Promise.resolve({value:void 0,done:!0}):r?Promise.reject(n):new Promise((h,y)=>{o.push([h,y])})),throw:h=>(t==null||t.unsubscribe(),l(h),Promise.reject(h)),return:()=>(t==null||t.unsubscribe(),_(),Promise.resolve({value:void 0,done:!0})),[Symbol.asyncIterator](){return this}}}}function ue(e,t){return t(e)}function L(e){setTimeout(()=>{throw e})}function fe(e){switch(Ee(e)){case p.Own:return e;case p.InteropObservable:return he(e);case p.ArrayLike:return de(e);case p.Promise:return pe(e);case p.AsyncIterable:return Q(e);case p.Iterable:return me(e);case p.ReadableStreamLike:return ye(e)}}function he(e){return new x(t=>{var n;const r=e[(n=Symbol.observable)!=null?n:"@@observable"]();if(m(r.subscribe))return r.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function de(e){return new x(t=>{xe(e,t)})}function pe(e){return new x(t=>{e.then(r=>{t.closed||(t.next(r),t.complete())},r=>t.error(r)).then(null,L)})}function me(e){return new x(t=>{for(const r of e)if(t.next(r),t.closed)return;t.complete()})}function Q(e){return new x(t=>{we(e,t).catch(r=>t.error(r))})}function ye(e){return Q(Pe(e))}async function we(e,t){for await(const r of e)if(t.next(r),t.closed)return;t.complete()}function xe(e,t){const r=e.length;for(let n=0;n<r;n++){if(t.closed)return;t.next(e[n])}t.complete()}var p;(function(e){e[e.Own=0]="Own",e[e.InteropObservable=1]="InteropObservable",e[e.ArrayLike=2]="ArrayLike",e[e.Promise=3]="Promise",e[e.AsyncIterable=4]="AsyncIterable",e[e.Iterable=5]="Iterable",e[e.ReadableStreamLike=6]="ReadableStreamLike"})(p||(p={}));function Ee(e){if(e instanceof x)return p.Own;if(je(e))return p.InteropObservable;if(Re(e))return p.ArrayLike;if(Ae(e))return p.Promise;if(be(e))return p.AsyncIterable;if(ge(e))return p.Iterable;if(_e(e))return p.ReadableStreamLike;throw new TypeError(`You provided ${e!==null&&typeof e=="object"?"an invalid object":`'${e}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}function m(e){return typeof e=="function"}function be(e){return Symbol.asyncIterator&&m(e==null?void 0:e[Symbol.asyncIterator])}async function*Pe(e){const t=e.getReader();try{for(;;){const{value:r,done:n}=await t.read();if(n)return;yield r}}finally{t.releaseLock()}}function _e(e){return m(e==null?void 0:e.getReader)}function Ae(e){return m(e==null?void 0:e.then)}function je(e){var t;return m(e[(t=Symbol.observable)!=null?t:"@@observable"])}function ge(e){return m(e==null?void 0:e[Symbol.iterator])}function Re(e){return e&&typeof e.length=="number"&&!m(e)}function Se(e){return e}class Le extends Error{constructor(){super("no elements in sequence"),this.name="EmptyError"}}function ve(e,t){return new Promise((r,n)=>{let i=!1,a;e.subscribe({next:o=>{a=o,i=!0},error:n,complete:()=>{i?r(a):n(new Le)}})})}function Ce(e){return t=>new x(r=>{let n=0;t.subscribe(F({destination:r,next:i=>{r.next(e(i,n++))}}))})}function Z(e){return t=>new x(r=>{let n=null,i=!1,a;n=t.subscribe(F({destination:r,error:o=>{a=fe(e(o,Z(e)(t))),n?(n.unsubscribe(),n=null,a.subscribe(r)):i=!0}})),i&&(n.unsubscribe(),n=null,a.subscribe(r))})}function Te(e){const t=m(e)?{next:e}:e;return t?r=>new x(n=>{var a;(a=t.subscribe)==null||a.call(t);let i=!0;r.subscribe(F({destination:n,next:o=>{var l;(l=t.next)==null||l.call(t,o),n.next(o)},error:o=>{var l;i=!1,(l=t.error)==null||l.call(t,o),n.error(o)},complete:()=>{var o;i=!1,(o=t.complete)==null||o.call(t),n.complete()},finalize:()=>{var o,l;i&&((o=t.unsubscribe)==null||o.call(t)),(l=t.finalize)==null||l.call(t)}}))}):Se}class ke{constructor(t,r,n,i="download_load"){c(this,"originalEvent");c(this,"xhr");c(this,"request");c(this,"type");c(this,"status");c(this,"response");c(this,"responseType");c(this,"loaded");c(this,"total");c(this,"responseHeaders");this.originalEvent=t,this.xhr=r,this.request=n,this.type=i;const{status:a,responseType:o}=r;this.status=a!=null?a:0,this.responseType=o!=null?o:"";const l=r.getAllResponseHeaders();this.responseHeaders=l?l.split(`
`).reduce((y,b)=>{const g=b.indexOf(": ");return y[b.slice(0,g)]=b.slice(g+2),y},{}):{},this.response=r.response;const{loaded:_,total:h}=t;this.loaded=_,this.total=h}}class $ extends Error{constructor(r,n,i){super(r);c(this,"xhr");c(this,"request");c(this,"status");c(this,"responseType");c(this,"response");this.name="AjaxError",this.xhr=n,this.request=i,this.status=n.status,this.responseType=n.responseType,this.response=n.response}}class De extends ${constructor(t,r){super("ajax timeout",t,r),this.name="AjaxTimeoutError"}}function Ue(e,t){return j({method:"GET",url:e,headers:t})}function He(e,t,r){return j({method:"POST",url:e,body:t,headers:r})}function qe(e,t){return j({method:"DELETE",url:e,headers:t})}function $e(e,t,r){return j({method:"PUT",url:e,body:t,headers:r})}function Fe(e,t,r){return j({method:"PATCH",url:e,body:t,headers:r})}const ze=Ce(e=>e.response);function Ie(e,t){return ze(j({method:"GET",url:e,headers:t}))}const j=(()=>{const e=t=>Be(typeof t=="string"?{url:t}:t);return e.get=Ue,e.post=He,e.delete=qe,e.put=$e,e.patch=Fe,e.getJSON=Ie,e})(),Oe="upload",J="download",H="loadstart",q="progress",Y="load";function Be(e){return new x(t=>{var B,G;const r={async:!0,crossDomain:!1,withCredentials:!1,method:"GET",timeout:0,responseType:"json",...e},{queryParams:n,body:i,headers:a}=r;let o=r.url;if(!o)throw new TypeError("url is required");if(n){let s;if(o.includes("?")){const S=o.split("?");if(2<S.length)throw new TypeError("invalid url");s=new URLSearchParams(S[1]),new URLSearchParams(n).forEach((D,C)=>s.set(C,D)),o=S[0]+"?"+s}else s=new URLSearchParams(n),o=o+"?"+s}const l={};if(a)for(const s in a)a.hasOwnProperty(s)&&(l[s.toLowerCase()]=a[s]);const _=r.crossDomain;!_&&!("x-requested-with"in l)&&(l["x-requested-with"]="XMLHttpRequest");const{withCredentials:h,xsrfCookieName:y,xsrfHeaderName:b}=r;if((h||!_)&&y&&b){const s=(G=(B=document==null?void 0:document.cookie.match(new RegExp(`(^|;\\s*)(${y})=([^;]*)`)))==null?void 0:B.pop())!=null?G:"";s&&(l[b]=s)}const g=Ge(i,l),E={...r,url:o,headers:l,body:g},u=e.createXHR?e.createXHR():new XMLHttpRequest;{const{progressSubscriber:s,includeDownloadProgress:S=!1,includeUploadProgress:D=!1}=e,C=(f,d)=>{u.addEventListener(f,()=>{var A;const w=d();(A=s==null?void 0:s.error)==null||A.call(s,w),t.error(w)})};C("timeout",()=>new De(u,E)),C("abort",()=>new $("aborted",u,E));const M=(f,d)=>new ke(d,u,E,`${f}_${d.type}`),V=(f,d,w)=>{f.addEventListener(d,A=>{t.next(M(w,A))})};D&&[H,q,Y].forEach(f=>V(u.upload,f,Oe)),s&&[H,q].forEach(f=>u.upload.addEventListener(f,d=>{var w;return(w=s==null?void 0:s.next)==null?void 0:w.call(s,d)})),S&&[H,q].forEach(f=>V(u,f,J));const W=f=>{const d="ajax error"+(f?" "+f:"");t.error(new $(d,u,E))};u.addEventListener("error",f=>{var d;(d=s==null?void 0:s.error)==null||d.call(s,f),W()}),u.addEventListener(Y,f=>{var w,A;const{status:d}=u;d<400?((w=s==null?void 0:s.complete)==null||w.call(s),t.next(M(J,f)),t.complete()):((A=s==null?void 0:s.error)==null||A.call(s,f),W(d))})}const{user:I,method:O,async:k}=E;I?u.open(O,o,k,I,E.password):u.open(O,o,k),k&&(u.timeout=E.timeout,u.responseType=E.responseType),"withCredentials"in u&&(u.withCredentials=E.withCredentials);for(const s in l)l.hasOwnProperty(s)&&u.setRequestHeader(s,l[s]);return g?u.send(g):u.send(),()=>{u&&u.readyState!==4&&u.abort()}})}function Ge(e,t){var r;if(!e||typeof e=="string"||Ye(e)||Ne(e)||Ve(e)||We(e)||Xe(e)||Ke(e))return e;if(Je(e))return e.buffer;if(typeof e=="object")return t["content-type"]=(r=t["content-type"])!=null?r:"application/json;charset=utf-8",JSON.stringify(e);throw new TypeError("Unknown body type")}const Me=Object.prototype.toString;function z(e,t){return Me.call(e)===`[object ${t}]`}function Ve(e){return z(e,"ArrayBuffer")}function We(e){return z(e,"File")}function Xe(e){return z(e,"Blob")}function Je(e){return typeof ArrayBuffer<"u"&&ArrayBuffer.isView(e)}function Ye(e){return typeof FormData<"u"&&e instanceof FormData}function Ne(e){return typeof URLSearchParams<"u"&&e instanceof URLSearchParams}function Ke(e){return typeof ReadableStream<"u"&&e instanceof ReadableStream}typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function";const Qe=e=>e&&e instanceof FormData||typeof e=="object"&&typeof e.append=="function"&&Object.prototype.toString.call(e)==="[object FormData]",P=(e,t,r)=>{r&&(e[t]=r)},Ze=e=>class extends e{constructor(){super(),this.url="",this.path="",this.body=void 0,this.async=!0,this.method="GET",this._headers={Accept:"application/json, text/plain, */*; q=0.01","Content-Type":"application/json"},this.headers=void 0,this.timeout=0,this.user="",this.password="",this.withCredentials=!1,this.xsrfCookieName="",this.xsrfHeaderName="",this.responseType="",this.queryParams=void 0,this.includeDownloadProgress=!1,this.includeUploadProgress=!1}_assignAjaxRxjsConfig(){const r={url:this._joinUrlData(),async:this.async,method:this.method,timeout:this.timeout,withCredentials:this.withCredentials,includeDownloadProgress:this.includeDownloadProgress,includeUploadProgress:this.includeUploadProgress};return P(r,"body",this.body),P(r,"headers",this._joinHeaders(this.body)),P(r,"user",this.user),P(r,"password",this.password),P(r,"xsrfCookieName",this.xsrfHeaderName),P(r,"xsrfHeaderName",this.xsrfHeaderName),P(r,"responseType",this.responseType),P(r,"queryParams",this.queryParams),r}_joinUrlData(){return typeof this.url=="string"&&typeof this.path=="string"?this.url.length&&this.path.length?`${this.url}/${this.path}`:this.url:""}_joinHeaders(r){const n={...this._headers,...this.headers||{}};return Qe(r)&&!this.avoidBoundary&&delete n["Content-Type"],n}_dispatchEvent(r,n){if(this.dispatchEventContext){const i=new CustomEvent(`${this.customEventPrefix}${r}`,{bubbles:!0,composed:!0,detail:n});this.dispatchEventContext.dispatchEvent(i)}}async generateRequest(){this._dispatchEvent("presend",!0);const r=await ve(j(this._assignAjaxRxjsConfig()).pipe(Te(n=>{const i={type:n.type,loaded:n.loaded,total:n.total};this._dispatchEvent("progress",i)}),Z(n=>(this._dispatchEvent("error",n),this._dispatchEvent("errorend",!0),this.lastError=n,Promise.reject(n)))));return this._dispatchEvent("response",r),this._dispatchEvent("responseend",!0),this.lastResponse=r,r}},et=ne(Ze);class nt extends et(EventTarget){constructor(t={}){super(),this.dispatchEventContext=this,this.lastResponse=void 0,this.lastError=void 0,this.customEventPrefix="ajax",this.avoidBoundary=!1,this._assignAjaxProviderConfig(t)}_assignAjaxProviderConfig(t){t&&typeof t=="object"&&Object.assign(this,t)}}export{nt as A};
